!function(){"use strict";angular.module("app",["app.controllers","app.filters","app.services","app.directives","app.routes","app.config"]);angular.module("app.routes",["ui.router","ui.router.state.events","ngStorage","satellizer"]),angular.module("app.controllers",["angular-carousel","ng-draggabilly","hljs","flow","FBAngular","dndLists","angular.filter","angularMoment","ngScrollbar","mdColorPicker","ngAnimate","ui.tree","toastr","ui.router","md.data.table","ngMaterial","ngStorage","restangular","ngMdIcons","angular-loading-bar","ngMessages","ngSanitize","leaflet-directive","nvd3"]),angular.module("app.filters",[]),angular.module("app.services",["angular-cache","ui.router","ngStorage","restangular","toastr"]),angular.module("app.directives",["ngMaterial","ngPapaParse"]),angular.module("app.config",[])}(),function(){"use strict";angular.module("app.routes").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,n){var r=function(t){return"/views/app/"+t+"/"+t+".html"};e.otherwise("/"),t.state("app",{"abstract":!0,views:{header:{templateUrl:r("header"),controller:"HeaderCtrl",controllerAs:"vm"},main:{},"map@":{templateUrl:r("map"),controller:"MapCtrl",controllerAs:"vm"},"sidemenu@":{templateUrl:r("sidemenu"),controller:"SidemenuCtrl",controllerAs:"vm"}}}).state("app.home",{url:"/",views:{"sidebar@":{templateUrl:r("home"),controller:"HomeCtrl",controllerAs:"vm"}}}).state("app.user",{url:"/user","abstract":!0}).state("app.user.login",{url:"/login",views:{"main@":{templateUrl:r("login"),controller:"LoginCtrl",controllerAs:"vm"}}}).state("app.user.profile",{url:"/my-profile",auth:!0,resolve:{profile:["DataService","$auth",function(t,e){return t.getOne("me").$object}]},views:{"main@":{templateUrl:r("user"),controller:"UserCtrl",controllerAs:"vm"}}}).state("app.index",{"abstract":!0,url:"/index",resolve:{countries:["CountriesService",function(t){return t.getData()}]}}).state("app.index.mydata",{url:"/my-data",auth:!0,views:{"sidebar@":{templateUrl:"/views/app/indexMyData/indexMyDataMenu.html",controller:"IndexMyDataMenuCtrl",controllerAs:"vm"},"main@":{templateUrl:r("indexMyData"),controller:"IndexMyDataCtrl",controllerAs:"vm"}}}).state("app.index.mydata.entry",{url:"/:name",auth:!0,views:{"sidebar@":{templateUrl:"/views/app/indexMyData/indexMyDataMenu.html",controller:"IndexMyDataMenuCtrl",controllerAs:"vm"},"main@":{templateUrl:"/views/app/indexMyData/indexMyDataEntry.html",controller:"IndexMyDataEntryCtrl",controllerAs:"vm"}}}).state("app.index.editor",{url:"/editor",auth:!0,resolve:{indices:["ContentService",function(t){return t.getIndices()}],indicators:["ContentService",function(t){return t.fetchIndicators({page:1,order:"title",limit:1e3,dir:"ASC"})}],styles:["ContentService",function(t){return t.getStyles()}],categories:["ContentService",function(t){return t.getCategories({indicators:!0,tree:!0})}]},views:{"sidebar@":{templateUrl:r("indexeditor"),controller:"IndexeditorCtrl",controllerAs:"vm"}}}).state("app.index.editor.indicators",{url:"/indicators",auth:!0}).state("app.index.editor.indicators.indicator",{url:"/:id",auth:!0,layout:"row",resolve:{indicator:["ContentService","$stateParams",function(t,e){return t.getIndicator(e.id)}]},views:{"main@":{templateUrl:"/views/app/indexeditor/indexeditorindicator.html",controller:"IndexeditorindicatorCtrl",controllerAs:"vm"}}}).state("app.index.editor.indizes",{url:"/indizes",auth:!0}).state("app.index.editor.indizes.data",{url:"/:id/:name",auth:!0,layout:"row",resolve:{index:["ContentService","$stateParams",function(t,e){return 0==e.id?{}:t.getItem(e.id)}]},views:{"main@":{templateUrl:"/views/app/indexeditor/indexeditorindizes.html",controller:"IndexeditorindizesCtrl",controllerAs:"vm"}}}).state("app.index.editor.indizes.data.add",{url:"/add",layout:"row",resolve:{indicators:["ContentService","$stateParams",function(t,e){return t.fetchIndicators({page:1,order:"title",limit:1e3,dir:"ASC"})}]},views:{"additional@":{templateUrl:"/views/app/indexeditor/indicators.html",controller:"IndexinidcatorsCtrl",controllerAs:"vm"}}}).state("app.index.editor.indicators.indicator.details",{url:"/:entry",auth:!0,layout:"row"}).state("app.index.editor.categories",{url:"/categories",auth:!0}).state("app.index.editor.categories.category",{url:"/:id",auth:!0,layout:"row",resolve:{category:["ContentService","$stateParams",function(t,e){return"new"==e.id?{}:t.getCategory(e.id)}]},views:{"main@":{templateUrl:"/views/app/indexeditor/indexeditorcategory.html",controller:"IndexeditorcategoryCtrl",controllerAs:"vm"}}}).state("app.index.create",{url:"/create",auth:!0,views:{"sidebar@":{templateUrl:r("indexcreator"),controller:"IndexcreatorCtrl",controllerAs:"vm"}}}).state("app.index.create.basic",{url:"/basic",auth:!0}).state("app.index.check",{url:"/checking",auth:!0,views:{"main@":{templateUrl:r("indexCheck"),controller:"IndexCheckCtrl",controllerAs:"vm"},"sidebar@":{templateUrl:"/views/app/indexCheck/indexCheckSidebar.html",controller:"IndexCheckSidebarCtrl",controllerAs:"vm"}}}).state("app.index.meta",{url:"/adding-meta-data",auth:!0,layout:"row",views:{"main@":{templateUrl:r("indexMeta"),controller:"IndexMetaCtrl",controllerAs:"vm"},"sidebar@":{templateUrl:"/views/app/indexMeta/indexMetaMenu.html",controller:"IndexMetaMenuCtrl",controllerAs:"vm"}}}).state("app.index.final",{url:"/final",auth:!0,layout:"row",views:{"main@":{templateUrl:r("indexFinal"),controller:"IndexFinalCtrl",controllerAs:"vm"},"sidebar@":{templateUrl:"/views/app/indexFinal/indexFinalMenu.html",controller:"IndexFinalMenuCtrl",controllerAs:"vm"}}}).state("app.export",{"abstract":!0,url:"/export",resolve:{countries:["DataService",function(t){return t.getOne("countries/isos").then(function(t){return t})}]}}).state("app.export.detail",{url:"/:id/:name",data:{pageName:"Export Data"},views:{"fullscreen@":{templateUrl:r("exported"),controller:"ExportedCtrl",controllerAs:"vm"}}}).state("app.export.detail.chapter",{url:"/chapter/:chapter",data:{pageName:"Export Data"},layout:"loose",fixLayout:!0,avoidRoots:!0,views:{"header@":{templateUrl:r("chapter"),controller:"ChapterCtrl",controllerAs:"vm"},"sidebar@":{templateUrl:r("chapterContent"),controller:"ChapterContentCtrl",controllerAs:"vm"}}}).state("app.export.detail.chapter.indicator",{url:"/:indicator/:indiname",layout:"loose",fixLayout:!0,avoidRoots:!0}).state("app.export.detail.chapter.indicator.country",{url:"/:iso",layout:"loose",fixLayout:!0,avoidRoots:!0}).state("app.export.detail.chapter.indicator.country.compare",{url:"/compare/:countries",layout:"loose",fixLayout:!0,avoidRoots:!0}).state("app.index.exports",{url:"/exports",auth:!0,data:{pageName:"Export Data"},views:{"sidebar@":{templateUrl:r("export"),controller:"ExportCtrl",controllerAs:"vm"}}}).state("app.index.exports.details",{url:"/:id/:name",auth:!0,layout:"row",data:{pageName:"Export Data"},views:{"main@":{templateUrl:"/views/app/export/exportDetails.html",controller:"ExportDetailsCtrl",controllerAs:"vm"}}}).state("app.index.exports.details.add",{url:"/add",layout:"row",resolve:{indicators:["ContentService","$stateParams",function(t,e){return t.fetchIndicators({page:1,order:"title",limit:1e3,dir:"ASC"})}]},views:{"additional@":{templateUrl:"/views/app/indexeditor/indicators.html",controller:"IndexinidcatorsCtrl",controllerAs:"vm"}}}).state("app.index.exports.details.style",{url:"/style/:styleId/:styleName",layout:"row",additional:"full",views:{"additional@":{templateUrl:r("exportStyle"),controller:"ExportStyleCtrl",controllerAs:"vm"}}}).state("app.index.exports.details.layout",{url:"/layout",layout:"row",views:{"additional@":{templateUrl:r("exportLayout"),controller:"ExportLayoutCtrl",controllerAs:"vm"}}}).state("app.index.basemaps",{url:"/basemaps",auth:!0,data:{pageName:"Export Data"},views:{"sidebar@":{templateUrl:r("basemaps"),controller:"BasemapsCtrl",controllerAs:"vm"}}}).state("app.index.basemaps.details",{url:"/:id/:name",auth:!0,layout:"row",data:{pageName:"Basemaps"},views:{"main@":{templateUrl:"/views/app/basemaps/basemapDetails.html",controller:"BasemapDetailsCtrl",controllerAs:"vm"}}}).state("app.index.list",{url:"/list",resolve:{indicators:["ContentService",function(t){return t.getIndicators({page:1,order:"title",limit:1e3,dir:"ASC"})}],indices:["ContentService",function(t){return t.fetchIndices()}],categories:["ContentService",function(t){return t.getCategories({indicators:!0,tree:!0})}]},views:{"sidebar@":{templateUrl:r("fullList"),controller:"FullListCtrl",controllerAs:"vm"}}}).state("app.index.list.filter",{url:"/:filter",layout:"row",views:{"main@":{templateUrl:"/views/app/fullList/filter.html",controller:"FullListFitlerCtrl",controllerAs:"vm"}}}).state("app.index.indicator",{url:"/indicator/:id/:name/:year/:gender/:iso",resolve:{indicator:["ContentService","$stateParams",function(t,e){return t.fetchIndicator(e.id)}]},views:{"sidebar@":{templateUrl:r("indicator"),controller:"IndicatorShowCtrl",controllerAs:"vm"}},params:{year:{squash:!0,value:null,dynamic:!0},gender:{squash:!0,value:null,dynamic:!0},iso:{squash:!0,value:null,dynamic:!0}}}).state("app.index.indicator.info",{url:"/details",layout:"row",resolve:{data:["ContentService","$state",function(t,e){return t.getIndicatorData(e.params.id,e.params.year,e.params.gender)}]},views:{"main@":{templateUrl:"/views/app/indicator/indicatorYearTable.html",controller:"IndicatorYearTableCtrl",controllerAs:"vm"}}}).state("app.index.show",{url:"/:id/:name",resolve:{data:["IndizesService","$stateParams",function(t,e){return t.fetchData(e.id)}],countries:["CountriesService",function(t){return t.getData()}]},views:{"sidebar@":{templateUrl:"/views/app/index/info.html",controller:"IndexCtrl",controllerAs:"vm"},selected:{templateUrl:"/views/app/index/selected.html"}}}).state("app.index.show.info",{url:"/info",views:{"main@":{controller:"IndexinfoCtrl",controllerAs:"vm",templateUrl:r("indexinfo")}}}).state("app.index.show.selected",{url:"/:item"}).state("app.index.show.selected.compare",{url:"/compare/:countries"}).state("app.conflict",{"abstract":!0,url:"/conflict"}).state("app.conflict.index",{url:"/index",resolve:{nations:["Restangular",function(t){return t.all("conflicts/nations")}],conflicts:["Restangular",function(t){return t.all("conflicts")}]},views:{"sidebar@":{controller:"ConflictsCtrl",controllerAs:"vm",templateUrl:r("conflicts")},"logo@":{templateUrl:r("logo")}}}).state("app.conflict.index.nation",{url:"/nation/:iso",resolve:{nation:["Restangular","$stateParams",function(t,e){return t.one("/conflicts/nations/",e.iso).get()}]},views:{"sidebar@":{controller:"ConflictnationCtrl",controllerAs:"vm",templateUrl:r("conflictnation")},"logo@":{templateUrl:r("logo")}}}).state("app.conflict.index.details",{url:"/:id",resolve:{conflict:["Restangular","$stateParams",function(t,e){return t.one("/conflicts/events/",e.id).get()}]},views:{"sidebar@":{controller:"ConflictdetailsCtrl",controllerAs:"vm",templateUrl:r("conflictdetails")},"items-menu@":{},"logo@":{templateUrl:r("logo")}}}).state("app.conflict.import",{url:"/import",auth:!0,views:{"sidebar@":{controller:"ConflictImportCtrl",controllerAs:"vm",templateUrl:r("conflictImport")}}}).state("app.importcsv",{url:"/importer",data:{pageName:"Import CSV"},views:{"main@":{templateUrl:r("importcsv")},map:{}}})}])}(),function(){"use strict";angular.module("app.routes").run(["$rootScope","$mdSidenav","$timeout","$auth","$state","$localStorage","$window","leafletData","toastr","VectorlayerService",function(t,e,n,r,a,o,i,c,s,l){function u(){n(function(){l.getMap().invalidateSize()},1e3)}t.sidebarOpen=!0,t.greyed=!1,t.fixLayout=!1,t.looseLayout=o.fullView||!1,t.started=!0,t.iframed=i.self!==i.top,t.goBack=function(){i.history.back()},t.toggleMenu=function(t){e(t).toggle()},t.$on("$stateChangeStart",function(e,n,o,i,c){return n.auth&&!r.isAuthenticated()?(s.error("Your not allowed to go there buddy!","Access denied"),e.preventDefault(),a.go("app.home")):(n.data&&n.data.pageName&&(t.current_page=n.data.pageName),"row"==n.layout?t.rowed=!0:t.rowed=!1,"loose"==n.layout?t.looseLayout=!0:t.looseLayout=!1,"full"==n.additional?t.addFull=!0:t.addFull=!1,1==n.fixLayout?t.fixLayout=!0:t.fixLayout=!1,"undefined"!=typeof n.views?(n.views.hasOwnProperty("sidebar@")||n.views.hasOwnProperty("main@")?t.sidebar=!0:t.sidebar=!1,n.views.hasOwnProperty("main@")||n.views.hasOwnProperty("additional@")?t.mainView=!0:t.mainView=!1,n.views.hasOwnProperty("additional@")?t.additional=!0:t.additional=!1,n.views.hasOwnProperty("items-menu@")?t.itemMenu=!0:t.itemMenu=!1,n.views.hasOwnProperty("logo@")?t.logoView=!0:t.logoView=!1,n.views.hasOwnProperty("fullscreen@")?t.fullscreenView=!0:t.fullscreenView=!1):n.avoidRoots?t.sidebar=!0:(t.additional=!1,t.itemMenu=!1,t.logoView=!1,t.mainView=!1,t.sidebar=!0),n.name.indexOf("conflict")>-1&&"app.conflict.import"!=n.name?t.noHeader=!0:t.noHeader=!1,"app.conflict.index.nation"==n.name?t.showItems=!0:t.showItems=!1,t.previousPage={state:i,params:c},void(t.stateIsLoading=!0))}),t.$on("$viewContentLoaded",function(t,e){}),t.$on("$stateChangeSuccess",function(e,n){t.stateIsLoading=!1,r.isAuthenticated(),u()})}])}(),function(){"use strict";angular.module("app.config").config(["$authProvider",function(t){t.loginUrl="/api/authenticate/auth",t.signupUrl="/api/authenticate/auth/signup",t.unlinkUrl="/api/authenticate/auth/unlink/",t.facebook({url:"/api/authenticate/facebook",clientId:"771961832910072"}),t.google({url:"/api/authenticate/google",clientId:"276634537440-cgtt14qj2e8inp0vq5oq9b46k74jjs3e.apps.googleusercontent.com"})}])}(),function(){"use strict";angular.module("app.config").config(["flowFactoryProvider",function(t){t.defaults={target:"/api/images/upload",permanentErrors:[404,500,501],maxChunkRetries:1,testChunks:!1,chunkRetryInterval:5e3,simultaneousUploads:4,singleFile:!0},t.on("catchAll",function(t){})}])}(),function(){"use strict";angular.module("app.config").config(["hljsServiceProvider",function(t){t.setOptions({tabReplace:"    "})}])}(),function(){"use strict";angular.module("app.config").config(["$logProvider",function(t){t.debugEnabled(!1)}])}(),function(){"use strict";angular.module("app.config").config(["cfpLoadingBarProvider",function(t){t.includeSpinner=!1}])}(),function(){"use strict";angular.module("app.config").config(["RestangularProvider",function(t){t.setBaseUrl("/api/").setDefaultHeaders({accept:"application/x.laravel.v1+json"}).setDefaultHttpFields({cache:!1}).addResponseInterceptor(function(t,e,n,r,a,o){var i;return i=t.data,t.meta&&(i._meta=t.meta),t.included&&(i._included=t.included),i})}])}(),function(){"use strict";angular.module("app.config").config(["$mdThemingProvider","$mdGestureProvider",function(t,e){var n=t.extendPalette("indigo",{500:"#006bb9",A200:"#006bb9"});t.definePalette("bluer",n),t.theme("default").primaryPalette("bluer").accentPalette("grey").warnPalette("red"),e.skipClickHijack()}])}(),function(){"use strict";angular.module("app.config").config(["toastrConfig",function(t){angular.extend(t,{autoDismiss:!0,containerId:"toast-container",maxOpened:2,newestOnTop:!0,positionClass:"toast-bottom-right",preventDuplicates:!1,preventOpenDuplicates:!1,target:"body",closeButton:!0,progressBar:!0})}])}(),function(){"use strict";angular.module("app.filters").filter("alphanum",function(){return function(t){return t?t.replace(/([^0-9A-Z])/g,""):null}})}(),function(){"use strict";angular.module("app.filters").filter("capitalize",function(){return function(t,e){return t?t.replace(/([^\W_]+[^\s-]*) */g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}):""}})}(),function(){"use strict";angular.module("app.filters").filter("findbyname",function(){return function(t,e,n){for(var r=[],a=0,o=t.length;a<o;a++)t[a][n].toLowerCase().indexOf(e.toLowerCase())>-1&&r.push(t[a]);return r}})}(),function(){"use strict";angular.module("app.filters").filter("humanReadable",function(){return function(t){if(!t)return"";for(var e=t.split("_"),n=0;n<e.length;n++)e[n]=e[n].charAt(0).toUpperCase()+e[n].slice(1);return e.join(" ")}})}(),function(){"use strict";angular.module("app.filters").filter("newline",function(){return function(t){return t.replace(/(\\r)?\\n/g,"<br /><br />")}})}(),function(){"use strict";angular.module("app.filters").filter("OrderObjectBy",function(){return function(t,e){if(!angular.isObject(t))return t;var n=[];for(var r in t)n.push(t[r]);return n.sort(function(t,n){return t=parseInt(t[e]),n=parseInt(n[e]),t-n}),n}}).filter("orderObjectByField",function(){return function(t,e,n){var r=[];return angular.forEach(t,function(t){r.push(t)}),r.sort(function(t,n){return t[e]>n[e]?1:-1}),n&&r.reverse(),r}})}(),function(){"use strict";function t(){return function(t,e,n){for(var r=[],a=0;a<t.length;a++)t[a].data[e]==n&&r.push(t[a]);return r}}angular.module("app.filters").filter("property",t)}(),function(){"use strict";angular.module("app.filters").filter("truncateCharacters",function(){return function(t,e,n){if(isNaN(e))return t;if(e<=0)return"";if(t&&t.length>e){if(t=t.substring(0,e),n)for(;" "===t.charAt(t.length-1);)t=t.substr(0,t.length-1);else{var r=t.lastIndexOf(" ");r!==-1&&(t=t.substr(0,r))}return t+"..."}return t}})}(),function(){"use strict";angular.module("app.filters").filter("truncateWords",function(){return function(t,e){if(isNaN(e))return t;if(e<=0)return"";if(t){var n=t.split(/\s+/);n.length>e&&(t=n.slice(0,e).join(" ")+"...")}return t}})}(),function(){"use strict";angular.module("app.filters").filter("trustHtml",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}])}(),function(){"use strict";angular.module("app.filters").filter("ucfirst",function(){return function(t){return t?t.substring(0,1).toUpperCase()+t.substring(1):null}})}(),function(){"use strict";angular.module("app.services").factory("BasemapsService",["DataService","toastr",function(t,e){return{basemaps:[],basemap:{},getBasemaps:function(e,n){var r=this;t.getAll("basemaps").then(function(t){r.basemaps=t,"function"==typeof e&&e(r.basemaps)},n)},getBasemap:function(e,n,r){var a=this;t.getOne("basemaps",e).then(function(t){a.basemap=t,"function"==typeof n&&n(a.basemap)})},setBasemap:function(t){return this.basemap=t},save:function(n,r,a){0!=n.id&&n.id?n.save().then(function(t){e.success("Save successful"),"function"==typeof r&&r(t)},function(t){e.error("Saving error"),"function"==typeof a&&a(t)}):t.post("basemaps",n).then(function(t){e.success("New Basemap successfully created"),"function"==typeof r&&r(t)},function(t){e.error("Saving error"),"function"==typeof a&&a(t)})},removeItem:function(n,r,a){t.remove("basemaps",n).then(function(t){e.success("Deletion successful"),"function"==typeof r&&r(t)},function(t){"function"==typeof a&&a(t)})}}}])}(),function(){"use strict";angular.module("app.services").factory("ColorHandleService",function(){var t;return t=function(){function t(t,e){this.color=t,this.stop=e}return t}()})}(),function(){"use strict";angular.module("app.services").factory("ContentService",["DataService","$filter",function(t,e){return{content:{indicators:[],indicator:{},data:[],categories:[],category:{},styles:[],infographics:[],indices:[]},backup:{},fetchIndices:function(e){return this.content.indices=t.getAll("index").$object},fetchIndicators:function(e){return this.content.indicators=t.getAll("indicators",e).$object},fetchCategories:function(e,n){return n?t.getAll("categories",e).$object:this.content.categories=t.getAll("categories",e).$object},fetchStyles:function(e){return this.content.styles=t.getAll("styles",e).$object},getIndices:function(t){return this.fetchIndices(t)},getCategories:function(t,e){return e?this.fetchCategories(t,e):0==this.content.categories.length?this.fetchCategories(t):this.content.categories},getIndicators:function(t){return this.content.indicators.length>0?this.content.indicators:this.fetchIndicators(t)},getStyles:function(t){return 0==this.content.styles.length?this.fetchStyles(t):this.content.styles},getIndicator:function(t){if(this.content.indicators.length>0)for(var e=0;e<this.content.indicators.length;e++)if(this.content.indicators[e].id==t)return this.content.indicators[e];return this.fetchIndicator(t)},fetchIndicator:function(e,n){var r=this;return t.getOne("indicators/"+e).then(function(t){return"function"==typeof n&&n(t),r.content.indicator=t})},fetchIndicatorWithData:function(e,n,r){t.getOne("indicators/",e,r).then(function(t){"function"==typeof n&&n(t)})},fetchIndicatorPromise:function(e){return t.getOne("indicators",e)},getIndicatorData:function(e,n,r){return n&&r&&"all"!=r?this.content.data=t.getAll("indicators/"+e+"/data/"+n+"/gender/"+r):n?this.content.data=t.getAll("indicators/"+e+"/data/"+n):this.content.data=t.getAll("indicators/"+e+"/data")},getIndicatorHistory:function(e,n,r){return t.getAll("indicators/"+e+"/history/"+n,{gender:r})},getItem:function(e){return this.content.data=t.getOne("index/",e)},removeContent:function(t,e){var n=this;return angular.forEach(e,function(r,a){if(r.id==t)return e.splice(a,1),!0;if(r.children){var o=n.removeContent(t,r.children);if(o)return o}}),!1},findContent:function(t,e){var n=null,r=this;return angular.forEach(e,function(e,a){if(e.id==t&&(n=e),e.children&&e.children.length&&!n){var o=r.findContent(t,e.children);o&&(n=o)}}),n},addItem:function(t){this.content.indices.push(t)},removeItem:function(e){return this.removeContent(e,this.content.indices),t.remove("index/",e)},updateItem:function(t){var e=this.findContent(t.id,this.content.indices);return e=t},getCategory:function(e){return this.content.categories.length?this.findContent(e,this.content.categories):this.content.category=t.getOne("categories/"+e).$object},removeCategory:function(e){return this.removeContent(e,this.content.categories),t.remove("categories/",e)},filterList:function(t,n,r){return r.length>0?(this.backup[t]?this.content[t]=angular.copy(this.backup[t]):this.backup[t]=angular.copy(this.content[t]),this.content[t]=e("filter")(this.content[t],n)):(this.content[t]=angular.copy(this.backup[t]),delete this.backup[t],this.content[t])},resetFilter:function(t){return this.backup[t]?(this.content[t]=angular.copy(this.backup[t]),delete this.backup[t],this.content[t]):this.content[t]}}}])}(),function(){"use strict";angular.module("app.services").factory("CountriesService",["DataService",function(t){return{countries:[],continents:[],indicator:null,fetchData:function(){return this.countries=t.getOne("countries/isos").$object},getData:function(){return this.countries.length||this.fetchData(),this.countries},getContinents:function(e,n){var r=this;return this.continents.length&&n==this.indicator?void e(this.continents):(this.indicator=n,t.getAll("continents",{indicator:n}).then(function(t){r.continents=t,e(t)}))}}}])}(),function(){"use strict";function t(t,e){function n(n,r){var a=t.all(n).getList(r);return a.then(function(){},function(t){e.error(t.statusText,"Connection Error")}),a}function r(e,n,r){return t.one(e,n).get(r)}function a(n,r){var r=t.all(n).post(r);return r.then(function(){},function(t){e.error(t.data.error,"Saving failed")}),r}function o(e,n){return t.all(e).put(n)}function i(e,n,r){return t.one(e,n).put(r)}function c(e,n){return t.one(e,n).remove()}return{getAll:n,getOne:r,post:a,put:o,update:i,remove:c}}angular.module("app.services").factory("DataService",t),t.$inject=["Restangular","toastr"]}(),function(){"use strict";angular.module("app.services").factory("DialogService",["$mdDialog",function(t){return{fromTemplate:function(e,n){var r={templateUrl:"./views/dialogs/"+e+"/"+e+".html"};return n&&(r.scope=n.$new()),t.show(r)},hide:function(){return t.hide()},alert:function(e,n){t.show(t.alert().title(e).content(n).ok("Ok"))},confirm:function(e,n){return t.show(t.confirm().title(e).content(n).ok("Ok").cancel("Cancel"))}}}])}(),function(){"use strict";angular.module("app.services").factory("ErrorCheckerService",["DataService","DialogService","IndexService",function(t,e,n){function r(t){return a.extendingChoices=[],a.data.length&&a.myData.then(function(t){angular.forEach(t,function(t){var e=0;angular.forEach(a.data[0].meta.fields,function(n){var r=JSON.parse(t.meta_data);angular.forEach(r,function(t){t.column==n&&e++})}),e>=a.data[0].meta.fields.length-3&&a.extendingChoices.push(t)}),a.extendingChoices.length&&(a.meta.year_field&&(a.meta.year=a.data[0].data[0][a.meta.year_field]),e.fromTemplate("extendData",$scope))}),extendedChoices}var a=this;return{checkMyData:r}}])}(),function(){"use strict";angular.module("app.services").service("ExportService",["DataService","toastr",function(t,e){var n=this;n._promise,n._promiseOne,n._callbacks=new Array,n._callbacksOne=new Array,n.exports,n.chapter,n.indicator,n.exporter={},n.getExports=function(e,r,a){angular.isDefined(n.exports)&&!a?"function"==typeof e&&e(n.exports):angular.isDefined(n._promise)&&!a?"function"==typeof e&&n._callbacks.push(e):(n._callbacks.push(e),n._promise=t.getAll("exports").then(function(t){n.exports=t,angular.forEach(n._callbacks,function(t){"undefined"!=typeof t&&t(n.exports)}),n._promise=null},r))},n.getExport=function(e,r,a,o){angular.isDefined(n.exporter)&&n.exporter.id==e&&!o?"function"==typeof r&&r(n.exporter):(n._callbacksOne.push(r),n._promiseOne=t.getOne("exports",e).then(function(t){n.exporter=t,n.exporter.items||(n.exporter.items=new Array),angular.forEach(n._callbacksOne,function(t){"undefined"!=typeof t&&t(n.exporter)}),n._promiseOne=null},a))},n.setExport=function(t){return n.exporter=t},n.getChapter=function(t,e,r,a){angular.isDefined(n.exporter)&&n.exporter.id==t?(n.chapter=n.exporter.items[e-1],a||("indicator"==n.chapter.type?n.indicator=n.chapter:n.indicator=n.getFirstIndicator(n.chapter.children)),"function"==typeof r&&r(n.chapter,n.indicator)):n.getExport(t,function(t){n.chapter=n.exporter.items[e-1],a||(n.indicator=n.getFirstIndicator(n.chapter.children)),"function"==typeof r&&r(n.chapter,n.indicator)})},n.getIndicator=function(t,e,r,a){var o="undefined"==typeof r;n.getExport(t,function(i){n.getChapter(t,e,function(t,e){o||(n.indicator=n.findIndicator(r)),a(n.indicator,n.chapter,n.exporter)},!o)})},n.getFirstIndicator=function(t){var e=null;return angular.forEach(t,function(t){"indicator"!=t.type||e?e||(e=n.getFirstIndicator(t.children)):e=t}),e},n.findIndicator=function(t){var e=null;return angular.forEach(n.exporter.items,function(n,r){"undefined"!=typeof n.indicator_id&&n.indicator_id==t&&(e=n),angular.forEach(n.children,function(n){n.indicator_id==t&&(e=n)})}),e},n.save=function(r,a){0!=n.exporter.id&&n.exporter.id?n.exporter.save().then(function(t){"function"==typeof r&&e.success("Save successfully"),r(t),n.getExports(function(){},function(){},!0)},function(t){e.error("Something went wrong!"),"function"==typeof a&&a(t)}):t.post("exports",n.exporter).then(function(t){n.exporter=t,n.exports.push(n.exporter),e.success("Successfully created"),"function"==typeof r&&r(t)},function(t){e.error("Something went wrong!"),"function"==typeof a&&a(t)})},n.removeItem=function(n,r,a){t.remove("exports",n).then(function(t){"function"==typeof r&&e.success("Successfully deleted"),r(t)},function(t){"function"==typeof a&&a(t)})}}])}(),function(){"use strict";angular.module("app.services").factory("IconsService",function(){var t={empty:"",agrar:"",anchor:"",butterfly:"",energy:"",sink:"",man:"",fabric:"",tree:"",water:""};return{getUnicode:function(e){return t[e]},getList:function(){return t}}})}(),function(){"use strict";angular.module("app.services").factory("IndexService",["CacheFactory","DataService","$state",function(t,e,n){var r,a,o,i={data:[],errors:[],iso_errors:[],meta:{iso_field:"",country_field:"",year_field:"",gender_field:"",table:[]},indicators:{},toSelect:[]};return t.get("importData")?(a=t.get("importData"),r=a.get("dataToImport")):(a=t("importData",{cacheFlushInterval:36e5,deleteOnExpire:"aggressive",storageMode:"localStorage"}),i=a.get("dataToImport")),{clear:function(){return n.go("app.index.create"),t.get("importData")&&a.remove("dataToImport"),i={data:[],errors:[],iso_errors:[],meta:{iso_field:"",country_field:"",year_field:"",gender_field:""},toSelect:[],indicators:{}}},addData:function(t){return i.data.push(t)},addIndicator:function(t){return i.indicators.push(t)},addToSelect:function(t){return i.toSelect.push(t)},addIsoError:function(t){return i.iso_errors.push(t)},removeToSelect:function(t){var e=i.toSelect.indexOf(t);return e>-1&&i.toSelect.splice(e,1)},setData:function(t){return i.data=t},setIsoField:function(t){return i.meta.iso_field=t},setCountryField:function(t){return i.meta.country_field=t},setGenderField:function(t){return i.meta.gender_field=t},setYearField:function(t){return i.meta.year_field=t},setErrors:function(t){return i.errors=t},setToLocalStorage:function(){a.put("dataToImport",i)},setIndicator:function(t,e){return i.indicators[t]=e},setActiveIndicatorData:function(t){return o=i.indicators[t.column_name]=t},getFromLocalStorage:function(){return i=a.get("dataToImport")},getFullData:function(){return i},getData:function(){return"undefined"!=typeof i&&i.data},getMeta:function(){return"undefined"!=typeof i&&i.meta},getToSelect:function(){return i.toSelect},getIsoField:function(){return i.meta.iso_field},getCountryField:function(){return i.meta.country_field},getErrors:function(){return"undefined"!=typeof i&&i.errors},getIsoErrors:function(){return"undefined"!=typeof i&&i.iso_errors},getFirstEntry:function(){return i.data[0]},getDataSize:function(){return i.data.length},getIndicator:function(t){return o=i.indicators[t]},getIndicators:function(){return"undefined"!=typeof i&&i.indicators},activeIndicator:function(){return o},resetIndicator:function(){return o=null},reduceIsoError:function(){return i.iso_errors.splice(0,1)},reduceError:function(){return i.errors.splice(0,1)},resetToSelect:function(){return i.toSelect=[]},resetLocalStorage:function(){return t.get("importData")&&a.remove("dataToImport"),i={data:[],errors:[],iso_errors:[],meta:{iso_field:"",country_field:"",year_field:""},toSelect:[],indicators:{}}},fetchNationData:function(t,n,r){return e.getOne("indicators/"+t+"/history",n).then(function(t){r(t)})}}}])}(),function(){"use strict";angular.module("app.services").factory("IndizesService",["DataService",function(t){return{index:{data:{data:null,structure:null},promises:{data:null,structur:null}},fetchData:function(e){return this.index.promises.data=t.getAll("index/"+e+"/year/latest"),this.index.promises.structure=t.getOne("index/"+e+"/structure"),this.index.data.data=this.index.promises.data.$object,this.index.data.structure=this.index.promises.structure.$object,this.index},getData:function(){return this.index.data.data},getStructure:function(){return this.index.data.structure},getDataPromise:function(){return this.index.promises.data},getStructurePromise:function(){return this.index.promises.structure},fetchNationData:function(e,n,r){t.getOne("index/"+e,n).then(function(t){r(t)})}}}])}(),function(){"use strict";angular.module("app.services").factory("RecursionHelper",["$compile",function(t){return{compile:function(e,n){angular.isFunction(n)&&(n={post:n});var r,a=e.contents().remove();return{pre:n&&n.pre?n.pre:null,post:function(e,o){r||(r=t(a)),r(e,function(t){o.append(t)}),n&&n.post&&n.post.apply(null,arguments)}}}}}])}(),function(){"use strict";angular.module("app.services").factory("ToastService",["$mdToast",function(t){var e=6e3,n="top right",r="OK";return{show:function(a){return!!a&&t.show(t.simple().content(a).position(n).action(r).hideDelay(e))},error:function(a){return!!a&&t.show(t.simple().content(a).position(n).theme("warn").action(r).hideDelay(e))}}}])}(),function(){"use strict";angular.module("app.services").factory("UserService",["DataService",function(t){return{user:{data:[]},myData:function(){return this.user.data=t.getAll("me/data")},myProfile:function(){},myFriends:function(){}}}])}(),function(){"use strict";angular.module("app.services").service("VectorlayerService",["$timeout","DataService",function(t,e){var n=this;this.fallbackBasemap={name:"Outdoor",url:"https://{s}.tiles.mapbox.com/v4/valderrama.d86114b6/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFnbm9sbyIsImEiOiJuSFdUYkg4In0.5HOykKk0pNP1N3isfPQGTQ",
type:"xyz",options:{noWrap:!0,continuousWorld:!1,detectRetina:!0}},this.basemap=this.fallbackBasemap,this.iso_field="iso_a2",this.canvas=!1,this.palette=[],this.ctx=null,this.keys={mazpen:"vector-tiles-Q3_Os5w",mapbox:"pk.eyJ1IjoibWFnbm9sbyIsImEiOiJuSFdUYkg4In0.5HOykKk0pNP1N3isfPQGTQ"},this.data={layer:"",name:"countries_big",baseColor:"#06a99c",iso3:"adm0_a3",iso2:"iso_a2",iso:"iso_a2",fields:"id,admin,adm0_a3,wb_a3,su_a3,iso_a3,iso_a2,name,name_long",field:"score"},this.map={data:[],current:[],structure:[],style:[]},this.mapLayer=null,this.layers={baselayers:{xyz:this.basemap}},this.center={lat:48.209206,lng:16.372778,zoom:3},this.maxbounds={southWest:{lat:90,lng:180},northEast:{lat:-90,lng:-180}},this.defaults={minZoom:2,maxZoom:6,zoomControlPosition:"bottomright"},this.legend=null,this.setMap=function(t){return this.mapLayer=t},this.getMap=function(){return this.mapLayer},this.setBaseLayer=function(e,r){e||(this.basemap=e=this.fallbackBasemap);var a=e.attribution||e.provider;r&&(a+=' | Data by <a href="'+r.url+'" target="_blank">'+r.title+"</a>"),this.layers.baselayers.xyz={name:e.name,url:e.url,type:"xyz",options:{noWrap:!0,continuousWorld:!1,detectRetina:!0,attribution:a}},t(function(){angular.forEach(n.mapLayer._layers,function(t){"https://www.23degree.org:3001/services/postgis/countries_big/geom/vector-tiles/{z}/{x}/{y}.pbf?fields=id,admin,adm0_a3,wb_a3,su_a3,iso_a3,iso_a2,name,name_long"!=t.options.url&&t.bringToBack()})})},this.setMapDefaults=function(t){this.defaults={zoomControl:t.zoom_controls,scrollWheelZoom:t.scroll_wheel_zoom},t.scroll_wheel_zoom?this.mapLayer.scrollWheelZoom.enable():this.mapLayer.scrollWheelZoom.disable(),t.legends?t.color_range?(this.legend={colors:[],labels:[]},"string"==typeof t.color_range&&(t.color_range=JSON.parse(t.color_range)),angular.forEach(t.color_range,function(t){t.hasLabel&&(n.legend.colors.push(t.color),t.label?n.legend.labels.push(t.label):n.legend.labels.push(parseFloat(100*t.stop).toFixed(0)))}),0==this.legend.colors.length&&(this.legend=null)):this.legend={colors:["#fff",t.base_color,"rgba(102,102,102,1)"],labels:["high","Ø","low"]}:this.legend=null},this.resetBaseLayer=function(){this.layers.baselayers.xyz=this.baselayer},this.setLayer=function(t){return this.data.layer=t},this.getLayer=function(){return this.data.layer},this.getName=function(){return this.data.name},this.fields=function(){return this.data.fields},this.iso=function(){return this.data.iso},this.iso3=function(){return this.data.iso3},this.iso2=function(){return this.data.iso2},this.createCanvas=function(t){this.canvas=document.createElement("canvas"),this.canvas.width=280,this.canvas.height=10,this.ctx=this.canvas.getContext("2d");var e=this.ctx.createLinearGradient(0,0,280,10);e.addColorStop(1,"rgba(255,255,255,0.6)"),e.addColorStop(.53,t||"rgba(128, 243, 198,0.6)"),e.addColorStop(0,"rgba(102,102,102,0.6)"),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,280,10),this.palette=this.ctx.getImageData(0,0,257,1).data},this.updateCanvas=function(t){var e=this.ctx.createLinearGradient(0,0,257,10);e.addColorStop(1,"rgba(255,255,255,0.6)"),e.addColorStop(.53,t||"rgba(128, 243, 198,0.6)"),e.addColorStop(0,"rgba(102,102,102,.6)"),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,257,10),this.palette=this.ctx.getImageData(0,0,257,1).data},this.createFixedCanvas=function(t){this.canvas=document.createElement("canvas"),this.canvas.width=257,this.canvas.height=10,this.ctx=this.canvas.getContext("2d");for(var e=this.ctx.createLinearGradient(0,0,257,10),n=0;n<t.length;n++)e.addColorStop(t[n].stop,t[n].color);this.ctx.fillStyle=e,this.ctx.fillRect(0,0,257,10),this.palette=this.ctx.getImageData(0,0,257,1).data},this.updateFixedCanvas=function(t){for(var e=this.ctx.createLinearGradient(0,0,257,10),n=0;n<t.length;n++)e.addColorStop(t[n].stop,t[n].color);this.ctx.clearRect(0,0,257,10),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,257,10),this.palette=this.ctx.getImageData(0,0,257,1).data},this.setBaseColor=function(t){return this.data.baseColor=t},this.countryClick=function(e){var n=this;t(function(){n.data.layer.options.onClick=e})},this.getColor=function(t){return this.palette[t]},this.setStyle=function(t){return this.map.style=t},this.invertStyle=function(){this.data.layer.setStyle(n.invertedStyle),n.data.layer.options.mutexToggle=!1,n.data.layer.redraw()},this.localStyle=function(){this.data.layer.setStyle(n.countriesStyle),n.data.layer.options.mutexToggle=!0,n.data.layer.redraw()},this.setData=function(t,e,n,r){this.map.data=t,this.map.structure=e,"undefined"!=typeof n&&(this.data.baseColor=n),this.canvas?"string"==typeof this.data.baseColor?this.updateCanvas(this.data.baseColor):this.updateFixedCanvas(this.data.baseColor):"string"==typeof this.data.baseColor?this.createCanvas(this.data.baseColor):this.createFixedCanvas(this.data.baseColor),r&&this.paintCountries()},this.getNationByIso=function(t,e){if("undefined"!=typeof e){if(0==e.length)return!1;var n={};angular.forEach(e,function(e){e.iso==t&&(n=e)})}else{if(0==this.map.data.length)return!1;var n={};angular.forEach(this.map.data,function(e){e.iso==t&&(n=e)})}return n},this.getNationByName=function(t){if(0==this.map.data.length)return!1},this.paintCountries=function(e,n,r){var a=this;t(function(){"undefined"!=typeof e&&null!=e?a.data.layer.setStyle(e):a.data.layer.setStyle(a.countriesStyle),"undefined"!=typeof n&&(a.data.layer.options.onClick=n),a.data.layer.redraw()})},this.resetSelected=function(t){"undefined"!=typeof this.data.layer.layers&&(angular.forEach(this.data.layer.layers[this.data.name+"_geom"].features,function(e,n){t?n!=t&&(e.selected=!1):e.selected=!1}),this.redraw())},this.setSelectedFeature=function(t,e,n){"undefined"==typeof this.data.layer.layers[this.data.name+"_geom"].features[t]?console.log(t):(n&&angular.forEach(this.data.layer.layers[this.data.name+"_geom"].features,function(t,e){t.selected=!1}),this.data.layer.layers[this.data.name+"_geom"].features[t].selected=e,this.redraw())},this.redraw=function(){this.data.layer.redraw()},this.paint=function(t){"string"==typeof t?(this.setBaseColor(t),this.ctx?this.updateCanvas(t):this.createCanvas(t)):this.ctx?this.updateFixedCanvas(t):this.createFixedCanvas(t),this.paintCountries()},this.gotoCountry=function(t){e.getOne("countries/bbox",[t]).then(function(t){var e=L.latLng(t.coordinates[0][0][1],t.coordinates[0][0][0]),r=L.latLng(t.coordinates[0][2][1],t.coordinates[0][2][0]),a=L.latLngBounds(e,r),o=[[0,0],[100,100]];n.mapLayer.fitBounds(a,{padding:o[1],maxZoom:4})})},this.gotoCountries=function(t,r){e.getOne("countries/bbox",r).then(function(t){var e=L.latLng(t.coordinates[0][0][1],t.coordinates[0][0][0]),r=L.latLng(t.coordinates[0][2][1],t.coordinates[0][2][0]),a=L.latLngBounds(e,r),o=[[100,100],[100,100]];n.mapLayer.fitBounds(a,{padding:o[1],maxZoom:4})})},this.countriesStyle=function(t){var e={},r=t.properties[n.iso_field],a=n.getNationByIso(r),o="score",i=t.type;switch(t.selected=!1,i){case 3:if("undefined"!=typeof a[o]&&null!=a[o]){var c=d3.scale.linear().domain([n.map.structure.min,n.map.structure.max]).range([0,256]),s=4*parseInt(c(parseFloat(a[o]))),l="rgba("+n.palette[s]+", "+n.palette[s+1]+", "+n.palette[s+2]+","+n.palette[s+3]/255+")";e.color=l,e.outline={color:l,size:1},e.selected={color:"rgba("+n.palette[s]+", "+n.palette[s+1]+", "+n.palette[s+2]+",0.3)",outline:{color:"rgba("+n.palette[s]+", "+n.palette[s+1]+", "+n.palette[s+2]+",1)",size:2}}}else e.color="rgba(255,255,255,0)",e.outline={color:"rgba(255,255,255,0)",size:1}}return e},this.invertedStyle=function(t){var e={},r=t.properties[n.iso_field],a=n.getNationByIso(r),o="score",i=d3.scale.linear().domain([n.map.structure.min,n.map.structure.max]).range([0,256]),c=4*parseInt(i(parseFloat(a[o]))),s="rgba("+n.palette[c]+", "+n.palette[c+1]+", "+n.palette[c+2]+","+n.palette[c+3]+")";return e.color="rgba(0,0,0,0)","undefined"!=typeof a[o]&&null!=a[o]&&(e.color="rgba("+n.palette[c]+", "+n.palette[c+1]+", "+n.palette[c+2]+",0.1)"),e.outline={color:"rgba(0,0,0,0)",size:0},e.selected={color:s,outline:{color:"rgba(0,0,0,0.3)",size:2}},e}}])}(),function(){"use strict";angular.module("app.controllers").controller("BasemapDetailsCtrl",["$state","BasemapsService","VectorlayerService",function(t,e,n){function r(){0!=t.params.id?e.getBasemap(t.params.id,function(t){a.basemap=t,n.setBaseLayer(a.basemap)}):console.log(a.basemap)}var a=this;a.basemap={},a.selected=[],a.options={save:function(){e.save(a.basemap,function(e){n.setBaseLayer(a.basemap),t.go("app.index.basemaps.details",{id:e.id,name:e.name})})},withSave:!0},r()}])}(),function(){"use strict";angular.module("app.controllers").controller("BasemapsCtrl",["$state","BasemapsService",function(t,e){function n(){e.getBasemaps(function(t){r.basemaps=t})}var r=this;r.basemaps=[],r.selection=[],r.options={drag:!1,type:"basemaps",allowMove:!1,allowDrop:!1,allowAdd:!0,allowDelete:!0,itemClick:function(e,n){t.go("app.index.basemaps.details",{id:e,name:n})},addClick:function(){t.go("app.index.basemaps.details",{id:0,name:"new"})},deleteClick:function(){angular.forEach(r.selection,function(n,a){e.removeItem(n.id,function(e){t.params.id==n.id&&t.go("app.index.basemaps");var a=r.basemaps.indexOf(n);r.basemaps.splice(a,1),r.selection=[]})})}},n()}])}(),function(){"use strict";angular.module("app.controllers").controller("ChapterCtrl",["$rootScope","$scope","$state","DialogService","ExportService",function(t,e,n,r,a){function o(t){c.ExportService.getChapter(n.params.id,t,function(e,r){n.params.iso?n.go("app.export.detail.chapter.indicator.country",{chapter:t,indicator:r.indicator_id,indiname:r.name,iso:n.params.iso}):n.go("app.export.detail.chapter.indicator",{chapter:t,indicator:r.indicator_id,indiname:r.name})})}function i(){r.fromTemplate("exportdata",e)}var c=this;c.gotoChapter=o,c.ExportService=a,c.showData=i,c.ExportService.getChapter(n.params.id,n.params.chapter||1)}])}(),function(){"use strict";angular.module("app.controllers").controller("ChapterContentCtrl",["$scope","$rootScope","$timeout","$state","DataService","ContentService","countries","ExportService","IndizesService","IndexService","DialogService","VectorlayerService",function(t,e,n,r,a,o,i,c,s,l,u,d){function p(t,e){if(t==I.selectedCountry.iso)return!1;var n=null,r=I.compareList.indexOf(t);angular.forEach(I.data,function(e){e.iso==t&&(n=e)}),r==-1?n&&(I.countriesList.push(n),I.compareList.push(n.iso),d.setSelectedFeature(n.iso,!0)):e&&(I.compareList.splice(r,1),I.countriesList.splice(I.countriesList.indexOf(n),1),d.setSelectedFeature(t,!1))}function f(){r.go("app.export.detail.chapter.indicator.country.compare",{countries:I.compareList.join("-vs-")}),d.gotoCountries(r.params.iso,I.compareList)}function m(t){t?(I.compare=!0,I.countriesList[0]=I.selectedCountry,d.invertStyle(),r.go("app.export.detail.chapter.indicator.country.compare",{countries:I.compareList.join("-vs-")})):(I.compare=!1,d.localStyle(),r.go("app.export.detail.chapter.indicator.country"),d.setSelectedFeature(r.params.iso,!0),I.compareList=[],I.countriesList=[])}function g(t){I.ExportService.getIndicator(r.params.id,r.params.chapter,r.params.indicator,function(e,n,r){I.selectedIndicator=e,b(e,t)})}function h(){if("indicator"==I.ExportService.chapter.type){var t=0;angular.forEach(I.ExportService.exporter.items,function(e,n){e.id==I.selectedIndicator.id&&(t=n)}),"undefined"!=typeof I.selectedCountry.iso?r.go("app.export.detail.chapter.indicator.country",{chapter:t+1,indicator:I.selectedIndicator.indicator_id,indiname:I.selectedIndicator.name,iso:I.selectedCountry.iso}):r.go("app.export.detail.chapter.indicator",{chapter:t+1,indicator:I.selectedIndicator.indicator_id,indiname:I.selectedIndicator.name})}else if(I.ExportService.chapter.id!=I.selectedIndicator.parent.id){var t=0;angular.forEach(I.ExportService.exporter.items,function(e,n){e.id==I.selectedIndicator.parent.id&&(t=n)}),"undefined"!=typeof I.selectedCountry.iso?r.go("app.export.detail.chapter.indicator.country",{chapter:t+1,indicator:I.selectedIndicator.indicator_id,indiname:I.selectedIndicator.name,iso:I.selectedCountry.iso}):r.go("app.export.detail.chapter.indicator",{chapter:t+1,indicator:I.selectedIndicator.indicator_id,indiname:I.selectedIndicator.name})}else"undefined"!=typeof I.selectedCountry.iso?r.go("app.export.detail.chapter.indicator.country",{indicator:I.selectedIndicator.indicator_id,indiname:I.selectedIndicator.name,iso:I.selectedCountry.iso}):r.go("app.export.detail.chapter.indicator",{indicator:I.selectedIndicator.indicator_id,indiname:I.selectedIndicator.name}),S()}function v(t){r.go("app.export.detail.chapter.indicator.country",{iso:t.iso}),d.setSelectedFeature(t.iso,!0,!0),x(t.iso),C(t.iso)}function y(t){var e=!1;return angular.forEach(I.data,function(n){n.iso==t&&(e=!0)}),e}function x(t){return angular.forEach(I.data,function(e){e.iso==t&&(I.selectedCountry=e)}),t}function C(t){r.params.countries||d.gotoCountry(t),l.fetchNationData(I.ExportService.indicator.indicator_id,t,function(n){I.current=n,d.setSelectedFeature(t,!0,!0),e.sidebarOpen=!0})}function b(t,e){o.fetchIndicatorWithData(t.indicator_id,function(n){I.data=n.data,I.structure=n,I.ExportService.data=n,I.circleOptions={color:I.ExportService.indicator.style.base_color||"#00ccaa",field:"rank",size:I.structure.count,hideNumbering:!0,width:60,height:60,fontSize:12},"string"==typeof t.style.color_range&&(t.style.color_range=JSON.parse(t.style.color_range)),d.setBaseLayer(t.style.basemap,t.indicator.dataprovider),d.setMapDefaults(t.style),d.setData(n.data,n,t.style.color_range||t.style.base_color,!0),"function"==typeof e&&e()},{data:!0})}function w(){u.fromTemplate("export",t)}function S(){n(function(){I.selectedCountry={},g(function(){if(r.params.iso){if(x(r.params.iso),C(r.params.iso),r.params.countries){var t=r.params.countries.split("-vs-");angular.forEach(t,function(t){p(t)}),I.activeTab=2,d.gotoCountries(r.params.iso,I.compareList)}}else I.selectedCountry={};"undefined"!=typeof I.ExportService.chapter&&I.ExportService.chapter.description&&w()})})}function _(){S()}var I=this;I.compare=!1,I.activeTab=0,I.selectedIndicator,I.selectedCountry={},I.current={},I.circleOptions={},I.countriesList=[],I.compareList=[],I.chapterId=r.params.chapter,I.ExportService=c,I.setCompare=m,I.selectCountry=v,I.showInfo=w,I.gotoIndicator=h,_(),d.countryClick(function(t){return!!y(t.feature.id)&&void(I.compare?(p(t.feature.id,!0),f()):(r.go("app.export.detail.chapter.indicator.country",{indicator:I.ExportService.indicator.indicator_id,indiname:I.ExportService.indicator.name,iso:t.feature.id}),x(t.feature.id),C(t.feature.id)))}),t.$watch("vm.selectedIndicator",function(t,e){return t!==e&&"undefined"!=typeof t.id&&(("undefined"==typeof e||t.id!=e.id)&&void I.gotoIndicator())})}])}(),function(){"use strict";angular.module("app.controllers").controller("ConflictImportCtrl",["Restangular","toastr","$state",function(t,e,n){function r(){var e={nations:a.nations,events:a.events};t.all("/conflicts/import").post(e).then(function(t){n.go("app.conflict.index")})}var a=this;a.nations=[],a.events=[],a.sum=0,a.saveToDb=r}])}(),function(){"use strict";angular.module("app.controllers").controller("ConflictdetailsCtrl",["$timeout","$state","$scope","$rootScope","VectorlayerService","conflict","conflicts","nations","DialogService",function(t,e,n,r,a,o,i,c,s){function l(){r.greyed=!0,c.getList().then(function(t){h.conflicts=t,a.resetSelected(),a.setData(h.conflicts,h.colors,!0),a.setStyle(f),a.countryClick(u),a.resetSelected(),angular.forEach(h.conflict.nations,function(t){var e=h.relations.indexOf(t.iso);e==-1&&(h.relations.push(t.iso),h.countries.push(t),a.setSelectedFeature(t.iso,!0))}),a.paintCountries(f)})}function u(t,n){var r=a.getNationByIso(t.feature.properties.iso_a2);"undefined"!=typeof r.intensity&&e.go("app.conflict.index.nation",{iso:r.iso})}function d(){s.fromTemplate("conflicttext",n)}function p(){s.fromTemplate("conflictmethode")}function f(t){var e={},n=t.properties[a.data.iso2],r=a.getNationByIso(n),o="intensity",i=4*parseInt(h.linearScale(parseFloat(r[o]))),c="rgba("+a.palette[i]+", "+a.palette[i+1]+", "+a.palette[i+2]+",0.6)";return e.color="rgba(0,0,0,0)",e.outline={color:"rgba(0,0,0,0)",size:0},e.selected={color:c,outline:{color:c,size:1}},e}function m(){return null==h.conflict?"remove":h.conflict.int2015==h.conflict.int2014?"remove":h.conflict.int2015<h.conflict.int2014?"trending_down":"trending_up"}function g(){return h.showCountries?"arrow_drop_up":"arrow_drop_down"}var h=this;h.conflict=o,h.conflicts=c,h.conflictItems=["territory","secession","autonomy","system","national_power","international_power","subnational_predominance","resources","other"],h.showMethod=p,h.showCountries=!1,h.getTendency=m,h.linearScale=d3.scale.linear().domain([0,5]).range([0,256]),h.colors=["#d4ebf7","#87cceb","#36a8c6","#268399","#0e6377"],h.relations=[],h.countries=[],h.showText=d,h.showCountriesButton=g,h.circleOptions={color:"#4fb0e5",field:"int2015",size:5,hideNumbering:!0,width:65,height:65},l()}])}(),function(){"use strict";angular.module("app.controllers").controller("ConflictitemsCtrl",["$rootScope",function(t){function e(e){console.log(e,t.conflictItems);var n=t.conflictItems.indexOf(e);n>-1?t.conflictItems.splice(n,1):t.conflictItems.push(e),0==t.conflictItems.length&&(t.conflictItems=["territory","secession","autonomy","system","national_power","international_power","subnational_predominace","resources","other"])}var n=this;n.showList=!1,t.conflictItems=["territory","secession","autonomy","system","national_power","international_power","subnational_predominace","resources","other"],n.toggleItem=e}])}(),function(){"use strict";angular.module("app.controllers").controller("ConflictnationCtrl",["$timeout","$state","$rootScope","nations","nation","VectorlayerService","DataService","DialogService",function(t,e,n,r,a,o,i,c){function s(){n.greyed=!0,n.featureItems=[],r.getList().then(function(t){f.conflicts=t,f.relations.push(f.nation.iso),f.featured=[],o.resetSelected(f.nation.iso),o.setData(f.conflicts,f.colors,!0),o.setStyle(p),o.countryClick(d),o.setSelectedFeature(f.nation.iso,!0),n.featureItems=[],angular.forEach(f.nation.conflicts,function(t){f.conflict||(f.conflict=t),t.int2015>f.conflict.int2015&&(f.conflict=t),angular.forEach(t,function(t,e){1==t&&f.featured.indexOf(e)==-1&&(f.featured.push(e),n.featureItems=f.featured)}),angular.forEach(t.nations,function(t){var e=f.relations.indexOf(t.iso);e==-1&&t.iso!=f.nation.iso&&(f.relations.push(t.iso),o.setSelectedFeature(t.iso,!0))})}),o.paintCountries(p)})}function l(){c.fromTemplate("conflictmethode")}function u(){return null==f.conflict?"remove":f.conflict.int2015==f.conflict.int2014?"remove":f.conflict.int2015<f.conflict.int2014?"trending_down":"trending_up"}function d(t,n){var r=o.getNationByIso(t.feature.properties.iso_a2);"undefined"!=typeof r.intensity&&e.go("app.conflict.index.nation",{iso:r.iso})}function p(t){var e={},n=t.properties[o.data.iso2],r=o.getNationByIso(n),a="intensity",i=4*parseInt(f.linearScale(parseFloat(r[a]))),c="rgba("+o.palette[i]+", "+o.palette[i+1]+", "+o.palette[i+2]+",0.6)";"rgba("+o.palette[i]+", "+o.palette[i+1]+", "+o.palette[i+2]+","+o.palette[i+3]+")";e.color="rgba(0,0,0,0)",e.outline={color:"rgba(0,0,0,0)",size:0};var s={color:c,size:1};return n==f.nation.iso&&(s={color:"rgba(54,56,59,0.8)",size:2},c=c),e.selected={color:c,outline:s},e}var f=this;f.nation=a,f.showMethod=l,f.linearScale=d3.scale.linear().domain([0,5]).range([0,256]),f.colors=["#d4ebf7","#87cceb","#36a8c6","#268399","#0e6377"],f.relations=[],f.featured=[],f.conflict=null,f.getTendency=u,f.circleOptions={color:"#4fb0e5",field:"intensity",size:5,hideNumbering:!0,width:65,height:65},s()}])}(),function(){"use strict";angular.module("app.controllers").controller("ConflictsCtrl",["$timeout","$state","$rootScope","$scope","conflicts","nations","VectorlayerService","Restangular","DialogService","Fullscreen",function(t,e,n,r,a,o,i,c,s,l){function u(){n.greyed=!0,i.setStyle(x),i.countryClick(y),o.getList().then(function(t){C.nations=t,i.setData(C.nations,C.colors,!0)}),a.getList().then(function(t){C.conflicts=t,v()})}function d(){l.isEnabled()?l.cancel():l.all()}function p(){C.relations=[],C.conflictFilterCount=0,C.conflictIntensities={veryLow:0,low:0,mid:0,high:0,veryHigh:0},C.chartData=[{label:1,value:0,color:C.colors[0]},{label:2,value:0,color:C.colors[1]},{label:3,value:0,color:C.colors[2]},{label:4,value:0,color:C.colors[3]},{label:5,value:0,color:C.colors[4]}],C.conflictTypes=[{type:"interstate",type_id:1,color:"#69d4c3",count:0},{type:"intrastate",count:0,type_id:2,color:"#b7b7b7"},{type:"substate",count:0,type_id:3,color:"#ff9d27"}]}function f(){s.fromTemplate("conflictmethode")}function m(t){var e=C.active.type.indexOf(t);e>-1?C.active.type.splice(e,1):C.active.type.push(t),0==C.active.type.length&&(C.active.type=[1,2,3]),v()}function g(t){switch(C.conflictFilterCount++,t.type_id){case 1:C.conflictTypes[0].count++;break;case 2:C.conflictTypes[1].count++;break;case 3:C.conflictTypes[2].count++}switch(t.int2015){case 1:C.conflictIntensities.veryLow++,C.chartData[0].value++;break;case 2:C.conflictIntensities.low++,C.chartData[1].value++;break;case 3:C.conflictIntensities.mid++,C.chartData[2].value++;break;case 4:C.conflictIntensities.high++,C.chartData[3].value++;break;case 5:C.conflictIntensities.veryHigh++,C.chartData[4].value++}h(t.nations)}function h(t){angular.forEach(t,function(t){C.relations.indexOf(t.iso)==-1&&C.relations.push(t.iso)})}function v(){p(),angular.forEach(C.conflicts,function(t){C.active.type.length?C.active.type.indexOf(t.type_id)>-1&&g(t):g(t)}),C.ready=!0,i.paintCountries()}function y(t,n){var r=i.getNationByIso(t.feature.properties.iso_a2);"undefined"!=typeof r.intensity&&e.go("app.conflict.index.nation",{iso:r.iso})}function x(t){var e={},n=t.properties[i.data.iso2],r=i.getNationByIso(n),a="intensity",o=t.type;if(t.selected=!1,C.relations.indexOf(n)==-1)e.color="rgba(255,255,255,0)",e.outline={color:"rgba(255,255,255,0)",size:1};else switch(o){case 3:if("undefined"!=typeof r[a]&&null!=r[a]&&n){var c=4*parseInt(C.linearScale(parseFloat(r[a]))),s="rgba("+i.palette[c]+", "+i.palette[c+1]+", "+i.palette[c+2]+","+i.palette[c+3]+")";e.color="rgba("+i.palette[c]+", "+i.palette[c+1]+", "+i.palette[c+2]+",0.6)",e.outline={color:s,size:1},e.selected={color:"rgba("+i.palette[c]+", "+i.palette[c+1]+", "+i.palette[c+2]+","+i.palette[c+3]+")",outline:{color:"rgba(66,66,66,0.9)",size:2}}}else e.color="rgba(255,255,255,0)",e.outline={color:"rgba(255,255,255,0)",size:1}}return e}var C=this;C.ready=!1,C.relations=[],C.showMethod=f,C.goFullscreen=d,C.linearScale=d3.scale.linear().domain([0,5]).range([0,256]),C.colors=["#add9f0","#87cceb","#36a8c6","#268399","#005573"],C.typesColors={interstate:"#69d4c3",intrastate:"#b7b7b7",substate:"#ff9d27"},C.active={conflict:[],type:[1,2,3]},C.toggleConflictFilter=m,C.conflictFilter=null,u()}])}(),function(){"use strict";angular.module("app.controllers").controller("ExportCtrl",["$state","ExportService",function(t,e){var n=this;n.exports=[],n.ExportService=e,n.selection=[],n.options={drag:!1,type:"exports",allowMove:!1,allowDrop:!1,allowAdd:!0,allowDelete:!0,itemClick:function(e,n){t.go("app.index.exports.details",{id:e,name:n})},addClick:function(){t.go("app.index.exports.details",{id:0,name:"new"})},deleteClick:function(){angular.forEach(n.selection,function(e,r){n.ExportService.removeItem(e.id,function(r){t.params.id==e.id&&t.go("app.index.exports");var a=n.exports.indexOf(e);n.ExportService.exports.splice(a,1),n.selection=[]})})}},n.ExportService.getExports(function(t){})}])}(),function(){"use strict";angular.module("app.controllers").controller("ExportDetailsCtrl",["$scope","$state","ExportService",function(t,e,n){function r(t,e){return angular.forEach(e,function(n,a){if(n.id==t.id)return e.splice(a,1),!0;if(n.children){var o=r(t,n.children);if(o)return o}}),!1}var a=this;a.ExportService=n,a.selected=[],a.options={exports:{onDrop:function(t,e,n,r){n.indicator_id=n.id,n.type="indicator"},inserted:function(t,e,n,r){},addClick:function(){e.go("app.index.exports.details.add")},addContainerClick:function(){var t={id:Date.now(),title:"I am a group... name me",type:"group"};a.ExportService.exporter.items.push(t)},deleteClick:function(){angular.forEach(a.selected,function(t,e){r(t,a.ExportService.exporter.items),a.selected=[]})},deleteDrop:function(t,e,n,o){r(e,a["export"].items),a.selection=[]},save:function(){a.ExportService.save(function(t){e.go("app.index.exports.details",{id:t.id,name:t.name})})}},style:{click:function(t){e.go("app.index.exports.details.style",{styleId:t.id,styleName:t.name})}},withSave:!0,styleable:!0,expandJustGroups:!0},0!=e.params.id?a.ExportService.getExport(e.params.id):a.ExportService.setExport({items:[]})}])}(),function(){"use strict";angular.module("app.controllers").controller("ExportLayoutCtrl",["ExportService","$state","$timeout",function(t,e,n){function r(){n(function(){a.exporter=t.exporter})}var a=this;a.exporter=t.exporter,r()}])}(),function(){"use strict";angular.module("app.controllers").controller("ExportStyleCtrl",["$scope","$timeout","$state","ContentService","ExportService","IndizesService","leafletData","leafletMapEvents","VectorlayerService","CountriesService","ColorHandleService","DialogService",function(t,e,n,r,a,o,i,c,s,l,u,d){function p(){e(function(){C.exporter=a.exporter,C.item=f(C.exporter.items,n.params.styleId),"undefined"==typeof C.item&&n.go("app.index.exports.details",{id:n.params.id,name:n.params.name}),C.item.style?"string"==typeof C.item.style.color_range&&(C.item.style.color_range=JSON.parse(C.item.style.color_range)):C.item.style={basemap_id:0,fixed_title:!1,fixed_description:!1,search_box:!0,share_options:!0,zoom_controls:!0,scroll_wheel_zoom:!1,layer_selection:!1,legends:!0,full_screen:!1,countries:[],color_range:[new C.ColorHandle("rgba(0, 0, 0, 0.60)",0),new C.ColorHandle("rgba(255, 0, 0, 0.60)",1)]},r.fetchIndicatorWithData(C.item.indicator_id,function(t){C.data=t.data,C.structure=t,s.setData(t.data,t,C.item.style.color_range||C.item.style.base_color,!0),l.getContinents(function(t){C.continents=t},C.item.indicator_id)},{data:!0})})}function f(t,e){var n;return angular.forEach(t,function(t){t.id==e?n=t:t.children&&!n&&(n=f(t.children,e))}),n}function m(){C.item.style.color_range=[new C.ColorHandle("rgba(102,102,102,0.6)",0),new C.ColorHandle(C.item.style.base_color,.53),new C.ColorHandle("rgba(255,255,255,0.6)",1)],s.paint(C.item.style.color_range)}function g(){C.item.style.color_range=void 0,s.paint(C.item.style.base_color)}function h(t){C.item.style.color_range.push(new C.ColorHandle("rgba(255,255,255,0.6)",t)),x()}function v(t){C.item.style.color_range.splice(C.item.style.color_range.indexOf(t),1),x()}function y(){x(),d.fromTemplate("gradientLabels",t)}function x(){return C.item.style.color_range.sort(function(t,e){return t.stop-e.stop})}var C=this;C.ColorHandle=u,C.addColorRange=m,C.removeColorRange=g,C.exporter={},C.item={},C.colorHandles=[],C.continentOptions={onlyWithChildren:!0},p();var b,w=500;t.$watch("vm.item.style",function(t,n){e.cancel(b),b=e(function(){t!==n&&t.basemap&&(s.setBaseLayer(t.basemap),s.paint(t.color_range||t.base_color))},w)},!0),C.addColorHandle=h,C.deleteColorHandle=v,C.setLabels=y}])}(),function(){"use strict";angular.module("app.controllers").controller("ExportedCtrl",["$rootScope","$state","ExportService","VectorlayerService","IndizesService",function(t,e,n,r,a){function o(){i.ExportService.getExport(e.params.id,function(t){})}var i=this;i.ExportService=n,o(),t.sidebarOpen=!1}])}(),function(){"use strict";angular.module("app.controllers").controller("FullListFitlerCtrl",["categories","ContentService",function(t,e){function n(t){var e=o.filter.indexOf(t);e==-1&&o.filter.push(t)}function r(t){n(t.id),t.children&&angular.forEach(t.children,function(t){n(t.id),r(t)})}function a(t){if(t.categories.length>0&&o.filter.length>0){var e=!1;return angular.forEach(t.categories,function(t){o.filter.indexOf(t.id)>-1&&(e=!0)}),e}return!0}var o=this;o.categories=t,o.filter=[],o.options={categories:{selectionChanged:function(){o.filter=[],angular.forEach(o.selection,function(t){r(t)}),e.filterList("indicators",a,o.selection),e.filterList("indices",a,o.selection)}}}}])}(),function(){"use strict";angular.module("app.controllers").controller("FullListCtrl",["$scope","$state","ContentService","categories","indicators","indices",function(t,e,n,r,a,o){var i=this;i.categories=r,i.indicators=a,i.indices=o,i.filter={sort:"title",toggle:function(){"app.index.list"==e.current.name?e.go("app.index.list.filter",{filter:"categories"}):(n.resetFilter("indicators"),n.resetFilter("indices"),e.go("app.index.list"))}},t.$watch(function(){return n.content.indicators},function(t,e){t!==e&&(i.indicators=t)}),t.$watch(function(){return n.content.indices},function(t,e){t!==e&&(i.indices=t)})}])}(),function(){"use strict";angular.module("app.controllers").controller("HomeCtrl",["DataService",function(t){var e=this;t.getAll("index",{is_official:!0}).then(function(t){e.indizes=t})}])}(),function(){"use strict";angular.module("app.controllers").controller("HeaderCtrl",["$scope","$mdMedia","leafletData","$state","$localStorage","$rootScope","$auth","toastr","$timeout",function(t,e,n,r,a,o,i,c,s){function l(){return i.isAuthenticated()}function u(){i.login(g.user).then(function(t){c.success("You have successfully signed in")})["catch"](function(t){c.error("Please check your email and password","Something went wrong")})}function d(){i.isAuthenticated()&&i.logout().then(function(t){r.current.auth&&r.go("app.home"),c.success("You have successfully logged out")})["catch"](function(t){})}function p(t,e){t(e)}function f(){o.looseLayout=!o.looseLayout,a.fullView=o.looseLayout,m()}function m(){s(function(){n.getMap("map").then(function(t){t.invalidateSize()})},300)}var g=this;o.isAuthenticated=l,g.doLogin=u,g.doLogout=d,g.openMenu=p,g.toggleView=f,g.authenticate=function(t){i.authenticate(t)},o.sidebarOpen=!0,t.$watch(function(){return o.current_page},function(e){t.current_page=e||"Page Name"}),t.$watch("$root.sidebarOpen",function(t,e){return t!=e&&void m()}),t.$watch(function(){return e("sm")},function(t){g.smallScreen=t})}])}(),function(){"use strict";angular.module("app.controllers").controller("ImportcsvCtrl",["$mdDialog",function(t){this.settings={printLayout:!0,showRuler:!0,showSpellingSuggestions:!0,presentationMode:"edit"},this.sampleAction=function(e,n){t.show(t.alert().title(e).content('You triggered the "'+e+'" action').ok("Great").targetEvent(n))},this.openCsvUpload=function(){t.show({templateUrl:"/views/app/importcsv/csvUploadDialog.html",bindToController:!0}).then(function(t){},function(){})}}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexCtrl",["$scope","$window","$mdSidenav","$rootScope","$filter","$state","$timeout","toastr","VectorlayerService","data","countries","leafletData","DataService",function(t,e,n,r,a,o,i,c,s,l,u,d,p){function f(){V.structureServer.then(function(t){V.dataServer.then(function(e){if(V.data=e,V.structure=t,V.structure.style||(V.structure.style={name:"default",title:"Default",base_color:"rgba(128, 243, 198,1)"}),P(V.structure.style.base_color),G(),o.params.item&&(V.setState(o.params.item),w()),o.params.countries){V.setTab(2),V.compare.countries.push(V.current),V.compare.active=!0,r.greyed=!0;var n=o.params.countries.split("-vs-");angular.forEach(n,function(t){V.compare.countries.push(U(t))}),n.push(V.current.iso),p.getOne("countries/bbox",n).then(function(t){V.bbox=t})}})})}function m(){e.history.back()}function g(t){o.go("app.index.show.selected",{id:t.id,name:t.name,item:o.params.item})}function h(){var t=!1;return angular.forEach(V.structure.children,function(e){e.children.length>0&&(t=!0)}),t}function v(t){""==t&&""==V.tabContent?V.tabContent="rank":V.tabContent=t,V.toggleButton=V.tabContent?"arrow_drop_up":"arrow_drop_down"}function y(t){V.setCurrent(U(t)),$(t)}function x(){V.menueOpen=!V.menueOpen,
V.closeIcon=1==V.menueOpen?"chevron_left":"chevron_right"}function C(t){V.current=t,V.setSelectedFeature(),n("left").open()}function b(t){V.mvtSource&&i(function(){V.mvtSource.layers[V.mvtCountryLayerGeom].features[V.current.iso].selected=!0})}function w(){if(V.current){var t=0;return angular.forEach(V.data,function(t){t[V.structure.name]=parseFloat(t[V.structure.name]),t.score=parseFloat(t[V.structure.name])}),t=V.data.indexOf(V.current)+1,V.current[V.structure.name+"_rank"]=t,V.circleOptions={color:V.structure.style.base_color||"#00ccaa",field:V.structure.name+"_rank",size:V.data.length},t}}function S(t){var e=V.data.indexOf(t)+1;return e}function _(){V.info=!V.info}function I(){return V.details=!V.details}function $(t){p.getOne("index/"+o.params.id,t).then(function(e){V.current.data=e,E(t)})}function E(t){o.params.countries||p.getOne("countries/bbox",[t]).then(function(t){V.bbox=t})}function D(t){(t&&!V.compare.active||!t&&V.compare.active)&&V.toggleComparison()}function k(){V.compare.countries=[V.current],V.compare.active=!V.compare.active,V.compare.active?(V.setTab(2),r.greyed=!0,V.mvtSource.options.mutexToggle=!1,V.mvtSource.setStyle(B)):(r.greyed=!1,angular.forEach(V.mvtSource.layers[V.mvtCountryLayerGeom].features,function(t){t.selected=!1}),V.mvtSource.layers[V.mvtCountryLayerGeom].features[V.current.iso].selected=!0,V.mvtSource.options.mutexToggle=!0,V.mvtSource.setStyle(N),p.getOne("countries/bbox",[V.current.iso]).then(function(t){V.bbox=t}),o.go("app.index.show.selected",{id:o.params.id,name:o.params.name,item:o.params.item}))}function A(t){var e=!1;angular.forEach(V.compare.countries,function(n,r){t==n&&n!=V.current&&(V.compare.countries.splice(r,1),e=!0)}),e||V.compare.countries.push(t);var n=[],r=[];return angular.forEach(V.compare.countries,function(t,e){n.push(t.iso),t[V.structure.iso]!=V.current.iso&&r.push(t.iso)}),n.length>1&&(p.getOne("countries/bbox",n).then(function(t){V.bbox=t}),o.go("app.index.show.selected.compare",{index:o.params.index,item:o.params.item,countries:r.join("-vs-")})),!e}function T(){return V.current?17*(V.getRank(V.current)-2):0}function O(){return V.current&&V.current.percent_change>0?"arrow_drop_up":"arrow_drop_down"}function z(t){}function M(t){var e=[];return angular.forEach(t.children,function(e){e.column_name==V.display.selectedCat.type&&(V.nodeParent=t),M(e)}),e}function F(){M(V.structure)}function U(t){var e={};return angular.forEach(V.data,function(n){n.iso==t&&(e=n)}),e}function P(t){V.canvas=document.createElement("canvas"),V.canvas.width=280,V.canvas.height=10,V.ctx=V.canvas.getContext("2d");var e=V.ctx.createLinearGradient(0,0,280,10);e.addColorStop(1,"rgba(255,255,255,0)"),e.addColorStop(.53,t||"rgba(128, 243, 198,1)"),e.addColorStop(0,"rgba(102,102,102,1)"),V.ctx.fillStyle=e,V.ctx.fillRect(0,0,280,10),V.palette=V.ctx.getImageData(0,0,257,1).data}function R(t){var e=V.ctx.createLinearGradient(0,0,280,10);e.addColorStop(1,"rgba(255,255,255,0)"),e.addColorStop(.53,t||"rgba(128, 243, 198,1)"),e.addColorStop(0,"rgba(102,102,102,1)"),V.ctx.fillStyle=e,V.ctx.fillRect(0,0,280,10),V.palette=V.ctx.getImageData(0,0,257,1).data}function B(t){var e={},n=t.properties[V.iso_field],r=U(n),a=V.structure.name||"score",o=4*parseInt(2.56*r[a]),i="rgba("+V.palette[o]+", "+V.palette[o+1]+", "+V.palette[o+2]+","+V.palette[o+3]+")";return e.color="rgba(0,0,0,0)",e.outline={color:"rgba(0,0,0,0)",size:0},e.selected={color:i,outline:{color:"rgba(0,0,0,0.3)",size:2}},e}function N(t){var e={},n=t.properties[V.iso_field],r=U(n),a=V.structure.name||"score",o=t.type;switch(n!=V.current.iso&&(t.selected=!1),o){case 3:if("undefined"!=typeof r[a]){var i=4*parseInt(2.56*parseInt(r[a])),c="rgba("+V.palette[i]+", "+V.palette[i+1]+", "+V.palette[i+2]+","+V.palette[i+3]+")";e.color="rgba("+V.palette[i]+", "+V.palette[i+1]+", "+V.palette[i+2]+",0.6)",e.outline={color:c,size:1},e.selected={color:"rgba("+V.palette[i]+", "+V.palette[i+1]+", "+V.palette[i+2]+",0.3)",outline:{color:"rgba(66,66,66,0.9)",size:2}};break}e.color="rgba(255,255,255,0)",e.outline={color:"rgba(255,255,255,0)",size:1}}return t.layer.name===s.getName()+"_geom"&&(e.staticLabel=function(){var e={html:t.properties.name,iconSize:[125,30],cssClass:"label-icon-text"};return e}),e}function G(){var t=s.getMap();V.map=t,V.mvtSource=s.getLayer(),i(function(){if(o.params.countries){V.mvtSource.options.mutexToggle=!1,V.mvtSource.setStyle(B),V.mvtSource.layers[V.mvtCountryLayerGeom].features[V.current.iso].selected=!0;var t=o.params.countries.split("-vs-");angular.forEach(t,function(t){V.mvtSource.layers[V.mvtCountryLayerGeom].features[t].selected=!0})}else V.mvtSource.setStyle(N),o.params.item&&(V.mvtSource.layers[V.mvtCountryLayerGeom].features[o.params.item].selected=!0)}),V.mvtSource.options.onClick=function(t,e){if(V.compare.active){var r=U(t.feature.properties[V.iso_field]);"undefined"!=typeof r[V.structure.name]?V.toggleCountrieList(r):c.error("No info about this location!",t.feature.properties.admin)}else{var r=U(t.feature.properties[V.iso_field]);"undefined"!=typeof r[V.structure.name]?(n("left").open(),V.current=U(t.feature.properties[V.iso_field])):c.error("No info about this location!",t.feature.properties.admin)}}}var V=this;V.map=null,V.dataServer=l.promises.data,V.structureServer=l.promises.structure,V.countryList=u,V.structure="",V.mvtScource=s.getLayer(),V.mvtCountryLayer=s.getName(),V.mvtCountryLayerGeom=V.mvtCountryLayer+"_geom",V.iso_field=s.data.iso2,V.nodeParent={},V.selectedTab=0,V.current="",V.tabContent="",V.toggleButton="arrow_drop_down",V.menueOpen=!0,V.info=!1,V.closeIcon="close",V.compare={active:!1,countries:[]},V.display={selectedCat:""},V.showTabContent=v,V.setTab=z,V.setState=y,V.setCurrent=C,V.setSelectedFeature=b,V.getRank=S,V.getOffset=T,V.getTendency=O,V.checkComparison=D,V.toggleOpen=x,V.toggleInfo=_,V.toggleDetails=I,V.toggleComparison=k,V.toggleCountrieList=A,V.mapGotoCountry=E,V.goBack=m,V.goToIndex=g,V.calcTree=F,V.isPrelast=h,f(),t.$watch("vm.current",function(t,e){t!==e&&(t.iso?(e.iso&&(V.mvtSource.layers[V.mvtCountryLayerGeom].features[e.iso].selected=!1),w(),$(t.iso),V.mvtSource.layers[V.mvtCountryLayerGeom].features[t.iso].selected=!0,"app.index.show.selected"!=o.current.name&&"app.index.show"!=o.current.name||o.go("app.index.show.selected",{id:o.params.id,name:o.params.name,item:t.iso})):o.go("app.index.show",{id:o.params.id,name:o.params.id}))}),t.$watch("vm.display.selectedCat",function(t,e){t!==e&&(console.log(t),R(t.color?t.color:"rgba(128, 243, 198,1)"),V.calcTree(),V.current.iso?o.params.countries?o.go("app.index.show.selected.compare",{id:t.id,name:t.name,item:V.current.iso,countries:o.params.countries}):o.go("app.index.show.selected",{id:t.id,name:t.name,item:V.current.iso}):o.go("app.index.show",{id:t.id,name:t.name}))}),t.$watch("vm.bbox",function(t,e){if(t!==e){var n=L.latLng(t.coordinates[0][0][1],t.coordinates[0][0][0]),r=L.latLng(t.coordinates[0][2][1],t.coordinates[0][2][0]),a=L.latLngBounds(n,r),o=[[0,0],[100,100]];V.compare.active&&(o=[[0,0],[0,0]]),V.map.fitBounds(a,{padding:o[1],maxZoom:6})}}),t.$on("$stateChangeSuccess",function(t,e,n,r,a){})}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexbaseCtrl",["$scope","$state",function(t,e){t.$state=e}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexCheckCtrl",["$scope","$state","$filter","$timeout","toastr","DialogService","IndexService",function(t,e,n,r,a,o,i){function c(){s(),l()}function s(){x.data||e.go("app.index.create")}function l(){r(function(){var t=n("groupBy")(x.data,"data."+x.meta.country_field);x.years=[];var e=0,r=null;angular.forEach(t,function(t,n){t.length>e&&(r=n)}),angular.forEach(t[r],function(t){x.years.push(t.data[x.meta.year_field])}),x.yearfilter=x.years[0]})}function u(t){return x.data=n("orderBy")(x.data,[t],!0)}function d(t,e){}function p(t){return t.errors.length>0?"md-warn":""}function f(t,e){return angular.forEach(x.data,function(t,n){angular.forEach(t.data,function(t,r){r==e&&(angular.forEach(x.data[n].errors,function(t,r){t.column==e&&(2!=t.type&&3!=t.type||i.reduceIsoError(),i.reduceError(),x.data[n].errors.splice(r,1))}),delete x.data[n].data[e])})}),i.setToLocalStorage(),!1}function m(){angular.forEach(x.selected,function(t,e){angular.forEach(t.errors,function(t,e){2!=t.type&&3!=t.type||(x.iso_errors--,i.reduceIsoError()),x.errors--,i.reduceError()}),x.data.splice(x.data.indexOf(t),1)}),x.selected=[],i.setToLocalStorage(),0==x.data.length&&(x.deleteData(),e.go("app.index.create"))}function g(){x.selected=[],angular.forEach(x.data,function(t,e){t.errors.length&&x.selected.push(t)})}function h(){x.row=x.selected[0],o.fromTemplate("editrow",t)}function v(){x.data=[]}function y(){angular.forEach(x.data,function(t,e){angular.forEach(t.data,function(e,n){if((isNaN(e)||e<0)&&("#NA"==e.toString().toUpperCase()||e<0||e.toString().toUpperCase().indexOf("N/A")>-1)){var r={type:"1",message:"Field in row is not valid for database use!",column:n,value:e};t.errors.push(r),x.errors.push(r)}})})}var x=this;x.data=i.getData(),x.meta=i.getMeta(),x.errors=i.getErrors(),x.iso_errors=i.getIsoErrors(),x.selected=[],x.yearfilter="",x.deleteData=v,x.deleteSelected=m,x.deleteColumn=f,x.onOrderChange=u,x.onPaginationChange=d,x.checkForErrors=p,x.selectErrors=g,x.searchForErrors=y,x.showUploadContainer=!1,x.editRow=h,x.years=[],x.query={filter:"",order:"-errors",limit:15,page:1},c()}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexCheckSidebarCtrl",["$rootScope","$scope","$state","IndexService","DataService","DialogService","toastr",function(t,e,n,r,a,o,i){function c(){}function s(){angular.forEach(d.data,function(t,e){if(angular.forEach(t.data,function(n,r){(isNaN(n)||n<0)&&("#NA"==n.toString().toUpperCase()||n.toString().toUpperCase().indexOf("N/A")>-1)&&(d.data[e].data[r]=null,t.errors.splice(0,1),d.errors.splice(0,1))}),!t.data[d.meta.iso_field]){var n={type:"2",message:"Iso field is not valid!",value:t.data[d.meta.iso_field],column:d.meta.iso_field,row:e},r=!1;angular.forEach(t.errors,function(t,e){2==t.type&&(r=!0)}),r||(t.errors.push(n),d.iso_errors.push(n))}}),r.setToLocalStorage()}function l(){if(!d.meta.iso_field)return i.error("Check your selection for the ISO field","Column not specified!"),!1;if(!d.meta.country_field)return i.error("Check your selection for the COUNTRY field","Column not specified!"),!1;if(d.meta.country_field==d.meta.iso_field)return i.error("ISO field and COUNTRY field can not be the same","Selection error!"),!1;t.stateIsLoading=!0,d.notFound=[];var e=[],n=0,c="iso-3166-2";angular.forEach(d.data,function(t,r){switch(t.data[d.meta.iso_field]&&(n+=3==t.data[d.meta.iso_field].length?1:0),t.data[d.meta.country_field]){case"Cabo Verde":t.data[d.meta.country_field]="Cape Verde";break;case"Democratic Peoples Republic of Korea":t.data[d.meta.country_field]="Democratic People's Republic of Korea";break;case"Cote d'Ivoire":t.data[d.meta.country_field]="Ivory Coast";break;case"Lao Peoples Democratic Republic":t.data[d.meta.country_field]="Lao People's Democratic Republic"}e.push({iso:t.data[d.meta.iso_field],name:t.data[d.meta.country_field]})});var c=n>=e.length/2?"iso-3166-1":"iso-3166-2";r.resetToSelect(),a.post("countries/byIsoNames",{data:e,iso:c}).then(function(e){t.stateIsLoading=!1,angular.forEach(e,function(t,e){angular.forEach(d.data,function(e,n){if(t.name==e.data[d.meta.country_field])if(t.data.length>1){var a={entry:e,options:t.data};r.addToSelect(a)}else if(1==t.data.length)if("undefined"!=typeof t.data)d.data[n].data[d.meta.iso_field]=t.data[0].iso,d.data[n].data[d.meta.country_field]=t.data[0].admin,e.errors.length&&angular.forEach(e.errors,function(t,n){2==t.type||3==t.type?(d.iso_errors.splice(0,1),e.errors.splice(n,1)):1==t.type&&t.column==d.meta.iso_field&&(d.errors.splice(0,1),e.errors.splice(n,1))});else{var o={type:"3",message:"Could not locate a valid iso name!",column:d.meta.country_field},i=!1;angular.forEach(d.data[n].errors,function(t,e){console.log(t),3==t.type&&(i=!0)}),i||(r.addIsoError(o),e.errors.push(o))}})}),d.iso_checked=!0,r.setToLocalStorage(),r.getToSelect().length&&o.fromTemplate("selectisofetchers")},function(e){t.stateIsLoading=!1,i.error("Please check your field selections",e.data.message)})}function u(){var t={data:[]};angular.forEach(d.data,function(e,n){return 0!=e.errors.length?void i.error("There are some errors left!","Huch!"):(e.data[0].year=d.meta.year,d.meta.year_field&&"year"!=d.meta.year_field&&delete e.data[d.meta.year_field],t.data.push(e.data),void 0)}),console.log(t),a.post("data/tables/"+d.addDataTo.table_name+"/insert",t).then(function(e){1==e&&(i.success(t.data.length+" items importet to "+d.meta.name,"Success"),d.data=r.clear(),n.go("app.index.mydata"))})}var d=this;d.data=r.getData(),d.meta=r.getMeta(),d.errors=r.getErrors(),d.iso_errors=r.getIsoErrors(),d.clearErrors=s,d.fetchIso=l,c(),d.extendData=u}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexFinalCtrl",["$state","IndexService","DataService","toastr",function(t,e,n,r){function a(){o()}function o(){c.data||t.go("app.index.create")}function i(a){if(a){var o={data:[]},i=[],s=[];c.loading=!0,angular.forEach(c.data,function(t,e){return 0!=t.errors.length?void r.error("There are some errors left!","Huch!"):void(t.data[c.meta.year_field]?(t.data.year=t.data[c.meta.year_field],c.meta.year_field&&"year"!=c.meta.year_field&&delete t.data[c.meta.year_field],c.meta.iso_type=3==t.data[c.meta.iso_field].length?"iso-3166-1":"iso-3166-2",o.data.push(t.data)):i.push(t))}),angular.forEach(c.indicators,function(t,e){if(e!=c.meta.iso_field&&e!=c.meta.country_field){var n=0;"undefined"!=typeof c.indicators[e].style&&(n=c.indicators[e].style.id);var r={column:e,title:c.indicators[e].title,description:c.indicators[e].description,measure_type_id:c.indicators[e].type.id||0,is_public:c.indicators[e].is_public||0,style_id:n,dataprovider_id:c.indicators[e].dataprovider.id||0},a=[];angular.forEach(c.indicators[e].categories,function(t){a.push(t.id)}),r.categories=a,s.push(r)}}),c.meta.fields=s,i.length>0&&r.error("for "+i.length+" entries","No year value found!"),n.post("data/tables",c.meta).then(function(a){n.post("data/tables/"+a.table_name+"/insert",o).then(function(n){1==n&&(r.success(o.data.length+" items importet to "+c.meta.name,"Success"),e.clear(),t.go("app.index.mydata"),c.data=[],c.step=0),c.loading=!1})},function(t){t.message&&r.error(t.message,"Ouch!"),c.loading=!1})}}var c=this;c.data=e.getData(),c.meta=e.getMeta(),c.errors=e.getErrors(),c.indicators=e.getIndicators(),c.saveData=i,a()}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexFinalMenuCtrl",["IndexService",function(t){var e=this;e.data=t.getData(),e.meta=t.getMeta(),e.indicators=t.getIndicators(),e.indicatorsLength=Object.keys(e.indicators).length}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexMetaCtrl",["$scope","$state","VectorlayerService","$timeout","IndexService","leafletData","toastr",function(t,e,n,r,a,o,i){function c(){s()}function s(){m.data||e.go("app.index.create")}function l(){m.min=1e7,m.max=0,angular.forEach(m.data,function(t,e){m.min=Math.min(t.data[m.indicator.column_name],m.min),m.max=Math.max(t.data[m.indicator.column_name],m.max)}),m.scale=d3.scale.linear().domain([m.min,m.max]).range([0,100])}function u(t){var e=0;return angular.forEach(m.data,function(n,r){n.data[m.meta.iso_field]==t&&(e=n.data[m.indicator.column_name])}),e}function d(t){var e={},r=t.properties.iso_a2,a=u(r)||m.min,o=(m.indicator.column_name,t.type);switch(o){case 3:var i=4*parseInt(2.56*parseInt(m.scale(a))),c="rgba("+n.getColor(i)+", "+n.getColor(i+1)+", "+n.getColor(i+2)+","+n.getColor(i+3)+")";e.color="rgba("+n.getColor(i)+", "+n.getColor(i+1)+", "+n.getColor(i+2)+",0.6)",e.outline={color:c,size:1},e.selected={color:"rgba("+n.getColor(i)+", "+n.getColor(i+1)+", "+n.getColor(i+2)+",0.3)",outline:{color:"rgba(66,66,66,0.9)",size:2}}}return t.layer.name===n.getName()+"_geom"&&(e.staticLabel=function(){var e={html:t.properties.name,iconSize:[125,30],cssClass:"label-icon-text"};return e}),e}function p(){m.mvtSource.setStyle(d),m.mvtSource.redraw()}function f(){l(),o.getMap("map").then(function(t){m.map=t,m.mvtSource=n.getLayer(),r(function(){p()})})}var m=this;m.min=1e7,m.max=0,m.indicators=[],m.scale="",m.data=a.getData(),m.meta=a.getMeta(),m.errors=a.getErrors(),m.indicator=a.activeIndicator(),m.countriesStyle=d,n.createCanvas("#ff0000"),c(),t.$watch(function(){return a.activeIndicator()},function(t,e){t!==e&&(m.indicator=t,m.min=1e7,m.max=0,m.indicator.style&&n.updateCanvas(m.indicator.style.base_color),f(),a.setToLocalStorage())}),t.$watch("vm.indicator",function(t,e){t!==e&&("undefined"!=typeof t.style_id?t.style_id!=e.style_id&&(t.style?n.updateCanvas(t.style.base_color):n.updateCanvas("#ff0000"),f()):("undefined"!=typeof t.categories&&(t.categories.length?n.updateCanvas(t.categories[0].style.base_color):n.updateCanvas("#ff0000")),f()),a.setActiveIndicatorData(t),a.setToLocalStorage())},!0)}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexMetaMenuCtrl",["$scope","$state","toastr","DataService","DialogService","IndexService",function(t,e,n,r,a,o){function i(t){"undefined"==typeof o.getIndicator(t)&&o.setIndicator(t,{column_name:t,title:t}),d.editingItem=t,d.indicator=o.getIndicator(t),o.setToLocalStorage()}function c(t){return"undefined"!=typeof t&&!!(t.title&&t.type&&t.dataprovider&&t.title.length>=3)}function s(t){return"undefined"!=typeof t&&"undefined"!=typeof t.categories&&!(!c(t)||!t.categories.length)}function l(){var t=0;return angular.forEach(d.indicators,function(e){c(e)&&t++}),t==Object.keys(d.indicators).length}function u(){if(!d.meta.year_field&&!d.meta.year)return a.fromTemplate("addYear",t),!1;var i={data:[]},c=[],s=[];return d.loading=!0,angular.forEach(d.data,function(t,e){return 0!=t.errors.length?void n.error("There are some errors left!","Huch!"):void(t.data[d.meta.year_field]?(t.data.year=t.data[d.meta.year_field],d.meta.year_field&&"year"!=d.meta.year_field&&delete t.data[d.meta.year_field],d.meta.iso_type=3==t.data[d.meta.iso_field].length?"iso-3166-1":"iso-3166-2",i.data.push(t.data)):d.meta.year?(t.data.year=d.meta.year,d.meta.iso_type=3==t.data[d.meta.iso_field].length?"iso-3166-1":"iso-3166-2",i.data.push(t.data)):c.push(t))}),angular.forEach(d.indicators,function(t,e){if(e!=d.meta.iso_field&&e!=d.meta.country_field){var n=0;"undefined"!=typeof d.indicators[e].style&&(n=d.indicators[e].style.id);var r={column:e,title:d.indicators[e].title,description:d.indicators[e].description,measure_type_id:d.indicators[e].type.id||0,is_public:d.indicators[e].is_public||0,style_id:n,dataprovider_id:d.indicators[e].dataprovider.id||0},a=[];angular.forEach(d.indicators[e].categories,function(t){a.push(t.id)}),r.categories=a,s.push(r)}}),d.meta.fields=s,c.length>0?(n.error("for "+c.length+" entries","No year value found!"),!1):void r.post("data/tables",d.meta).then(function(t){r.post("data/tables/"+t.table_name+"/insert",i).then(function(t){1==t&&(n.success(i.data.length+" items importet to "+d.meta.name,"Success"),o.clear(),e.go("app.index.mydata"),d.data=[],d.step=0),d.loading=!1})},function(t){t.message&&n.error(t.message,"Ouch!"),d.loading=!1})}var d=this;d.data=o.getData(),d.meta=o.getMeta(),o.resetIndicator(),d.indicators=o.getIndicators(),d.selectForEditing=i,d.checkFull=s,d.checkBase=c,d.checkAll=l,d.saveData=u,t.$watch(function(){return o.activeIndicator()},function(t,e){t!==e&&(d.indicators[t.column_name]=t)},!0),t.$watch(function(){return o.activeIndicator()},function(e,n){e!==n&&"undefined"!=typeof n&&null!=n&&(d.askedToReplicate||(d.preProvider=d.indicators[n.column_name].dataprovider,d.preMeasure=d.indicators[n.column_name].measure_type_id,d.preType=d.indicators[n.column_name].type,d.preCategories=d.indicators[n.column_name].categories,d.prePublic=d.indicators[n.column_name].is_public,d.preStyle=d.indicators[n.column_name].style,a.fromTemplate("copyprovider",t)))})}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexMyDataCtrl",function(){})}(),function(){"use strict";angular.module("app.controllers").controller("IndexMyDataEntryCtrl",["UserService",function(t){var e=this;e.data=t.myData()}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexMyDataMenuCtrl",["UserService",function(t){function e(){t.myData().then(function(t){r.data=t,n()})}function n(){console.log(r.data),angular.forEach(r.data,function(t){t.meta=JSON.parse(t.meta_data)})}var r=this;r.data=[],e()}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexcreatorCtrl",["$scope","DialogService","DataService","$timeout","$state","$filter","leafletData","toastr","IconsService","IndexService","VectorlayerService",function(t,e,n,r,a,o,i,c,s,l,u){function d(){l.resetLocalStorage()}function p(t){return t?"remove":"add"}function f(){E.showResources=!E.showResources,E.showResources&&E.listResources()}function m(){E.resources||n.getAll("data/tables").then(function(t){E.resources=t,E.selectedResources=[],E.sortedResources=[]})}function g(t){return E.selectedResources.indexOf(t)>-1}function h(t,e){angular.forEach(e,function(n,r){n==t&&(e.splice(r,1),E.selectedForGroup.splice(E.selectedForGroup.indexOf(n),1),E.selectedResources.splice(E.selectedResources.indexOf(n),1)),h(t,n.nodes)})}function v(t){var e=E.selectedResources.indexOf(t);e>-1?(E.selectedResources.splice(e,1),h(t,E.groups)):(E.selectedResources.push(t),1==E.selectedForGroup.length&&"undefined"!=typeof E.selectedForGroup[0].isGroup?E.selectedForGroup[0].nodes.push(t):E.groups.push(t))}function y(t){console.log(t)}function x(t){console.log(t)}function C(t){var e=E.selectedForGroup.indexOf(t);e>-1?E.selectedForGroup.splice(e,1):E.selectedForGroup.push(t)}function b(t){return E.selectedForGroup.indexOf(t)>-1}function w(){var t={title:"Group",isGroup:!0,nodes:[]};1==E.selectedForGroup.length&&"undefined"!=typeof E.selectedForGroup[0].isGroup?E.selectedForGroup[0].nodes.push(t):E.selectedForGroup.length>0?(angular.forEach(E.selectedForGroup,function(e,n){t.nodes.push(e),h(e,E.selectedForGroup)}),E.groups.push(t),E.selectedForGroup=[]):E.groups.push(t)}function S(){var t={title:"Cloned Elements",isGroup:!0,nodes:[]};angular.forEach(E.selectedForGroup,function(e,n){t.nodes.push(e)}),E.groups.push(t),E.selectedForGroup=[]}function _(t){E.editItem=t}function I(t,e){h(t,e)}function $(){if(!E.saveDisabled){if(E.saveDisabled=!0,"undefined"==typeof E.newIndex)return c.error("You need to enter a title!","Info missing"),void(E.saveDisabled=!1);if(!E.newIndex.title)return c.error("You need to enter a title!","Info missing"),void(E.saveDisabled=!1);E.newIndex.data=E.groups,n.post("index",E.newIndex).then(function(t){E.saveDisabled=!1,c.success("Your Index has been created","Success"),a.go("app.index.show",{index:t.name})},function(t){E.saveDisabled=!1,c.error(t.message,"Upps!!")})}}var E=this;E.map=null,E.data=[],E.toSelect=[],E.selected=[],E.selectedRows=[],E.selectedResources=[],E.sortedResources=[],E.groups=[],E.myData=[],E.addDataTo={},E.selectedForGroup=[],E.iso_errors=0,E.iso_checked=!1,E.saveDisabled=!1,E.selectedIndex=0,E.step=0,E.openClose=p,E.listResources=m,E.toggleListResources=f,E.selectedResource=g,E.toggleResource=v,E.increasePercentage=y,E.decreasePercentage=x,E.toggleGroupSelection=C,E.existsInGroupSelection=b,E.addGroup=w,E.cloneSelection=S,E.editEntry=_,E.removeEntry=I,E.saveIndex=$,E.icons=s.getList(),E.meta={iso_field:"",country_field:"",table:[]},E.query={filter:"",order:"-errors",limit:15,page:1},d()}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexeditorcategoryCtrl",["$state","category","categories","DataService","ContentService",function(t,e,n,r,a){var o=this;o.category=e,o.categories=n,o.options={globalSave:!0,postDone:function(e){t.go("app.index.editor.categories.category",{id:e.id})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexeditorCtrl",["$scope","$filter","$timeout","$state","indicators","indices","styles","categories","DataService","ContentService","toastr",function(t,e,n,r,a,o,i,c,s,l,u){function d(t){switch(t){case 1:r.go("app.index.editor.indicators");break;case 2:r.go("app.index.editor.categories");break;case 0:"undefined"!=typeof r.params.id?r.go("app.index.editor.indizes.data",{id:r.params.id}):r.go("app.index.editor.indizes");break;case 3:}}var p=this;p.categories=c,p.composits=o,p.styles=i,p.indicators=a,p.checkTabContent=d,p.active=0,p.selectedTab=0,p.selection={indices:[],indicators:[],styles:[],categories:[]},p.options={composits:{drag:!1,type:"composits",allowMove:!1,allowDrop:!1,allowAdd:!0,allowDelete:!0,itemClick:function(t,e){r.go("app.index.editor.indizes.data",{id:t,name:e})},addClick:function(){r.go("app.index.editor.indizes.data",{id:0,name:"new"})},deleteClick:function(){angular.forEach(p.selection.indices,function(t,e){l.removeItem(t.id).then(function(e){r.params.id==t.id&&r.go("app.index.editor.indizes"),p.selection.indices=[]})})}},categories:{drag:!1,type:"categories",allowAdd:!0,allowDelete:!0,addClick:function(){r.go("app.index.editor.categories.category",{id:"new"})},itemClick:function(t,e){r.go("app.index.editor.categories.category",{id:t})},deleteClick:function(){angular.forEach(p.selection.categories,function(t,e){l.removeCategory(t.id).then(function(e){r.params.id==t.id&&r.go("app.index.editor.categories"),p.selection.categories=[]})})}},styles:{drag:!1,type:"styles",withColor:!0}},t.$on("$stateChangeSuccess",function(t,e,n,r,a){"undefined"==typeof n.id?p.active=0:p.active=n.id,e.name.indexOf("app.index.editor.indicators")!=-1?p.selectedTab=1:e.name.indexOf("app.index.editor.categories")!=-1?p.selectedTab=2:e.name.indexOf("app.index.editor.indizes")!=-1&&(p.selectedTab=0)})}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexeditorindicatorCtrl",["$scope","$state","$timeout","VectorlayerService","leafletData","ContentService","indicator",function(t,e,n,r,a,o,i){function c(){"app.index.editor.indicator.details"==e.current.name&&("infographic"==e.params.entry?p.selected=1:"indizes"==e.params.entry?p.selected=2:"style"==e.params.entry?p.selected=3:"categories"==e.params.entry?p.selected=4:p.selected=0)}function s(){p.min=1e7,p.max=0,angular.forEach(p.data,function(t,e){p.min=Math.min(t.score,p.min),p.max=Math.max(t.score,p.max)}),p.scale=d3.scale.linear().domain([p.min,p.max]).range([0,100])}function l(t){var e=0;return angular.forEach(p.data,function(n,r){n.iso==t&&(e=n.score)}),e}function u(t){var e={},n=t.properties.iso_a2,a=l(n)||p.min,o=t.type;switch(o){case 3:var i=4*parseInt(2.56*parseInt(p.scale(a))),c="rgba("+r.getColor(i)+", "+r.getColor(i+1)+", "+r.getColor(i+2)+","+r.getColor(i+3)+")";e.color="rgba("+r.getColor(i)+", "+r.getColor(i+1)+", "+r.getColor(i+2)+",0.6)",e.outline={color:c,size:1},e.selected={color:"rgba("+r.getColor(i)+", "+r.getColor(i+1)+", "+r.getColor(i+2)+",0.3)",outline:{color:"rgba(66,66,66,0.9)",size:2}}}return e}function d(){s(),a.getMap("map").then(function(t){p.map=t,p.mvtSource=r.getLayer(),n(function(){p.mvtSource.setStyle(u)})})}var p=this;p.indicator=i,p.scale="",p.min=1e7,p.max=0,p.selected=0,c(),o.getIndicatorData(e.params.id).then(function(t){var e="#ff0000";"undefined"==typeof p.indicator.style?angular.forEach(p.indicator.categories,function(t){"undefined"!=typeof t.style&&(e=t.style.base_color)}):p.indicator.style&&(e=p.indicator.style.base_color),r.createCanvas(e),p.data=t,s(),d()}),t.$on("$stateChangeSuccess",function(){c()})}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexinidcatorsCtrl",["indicators","DataService","ContentService",function(t,e,n){var r=this;r.indicators=t}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexeditorindizesCtrl",["$scope","$state","$timeout","VectorlayerService","leafletData","ContentService","index",function(t,e,n,r,a,o,i){function c(){}function s(t,e){return angular.forEach(e,function(n,r){if(n.id==t.id)return e.splice(r,1),!0;if(n.children){var a=s(t,n.children);if(a)return a}}),!1}function l(){}var u=this;u.index=i,u.scale="",u.min=1e7,u.max=0,u.selected=[],l(),u.options={indizes:{addClick:function(){e.go("app.index.editor.indizes.data.add")},addContainerClick:function(){var t={title:"I am a group... name me"};u.index.children.push(t)},deleteClick:function(){console.log(u),angular.forEach(u.selected,function(t,e){o.removeItem(t.id).then(function(e){s(t,u.index.children),u.selected=[]})})},deleteDrop:function(t,e,n,r){o.removeItem(e.id).then(function(t){s(e,u.index.children),u.selection=[]})}},withSave:!0},c(),t.$on("$stateChangeSuccess",function(){l()})}])}(),function(){"use strict";angular.module("app.controllers").controller("IndexinfoCtrl",["IndizesService",function(t){var e=this;e.structure=t.getStructure()}])}(),function(){"use strict";angular.module("app.controllers").controller("IndicatorShowCtrl",["$state","$filter","$timeout","indicator","countries","ContentService","VectorlayerService","toastr",function(t,e,n,r,a,o,i,c){function s(){l(),i.setStyle(C),i.countryClick(g),n(function(){if(t.params.year){b.year=t.params.year;for(var e=0;e<b.indicator.years.length;e++)b.indicator.years[e].year==t.params.year&&(b.active=e)}else b.active||(b.active=0);if(b.indicator.gender)if("all"!=t.params.gender){b.gender=t.params.gender;for(var e=0;e<b.indicator.gender.length;e++)b.indicator.gender[e].gender==t.params.gender&&(b.activeGender=e)}else b.activeGender||(b.activeGender=0);else b.activeGender||(b.activeGender=0);x(b.year,b.gender)})}function l(){b.range={max:-1e8,min:1e8}}function u(){"app.index.indicator"==t.current.name?t.go("app.index.indicator.info"):t.go("app.index.indicator")}function d(t){var e=b.data.indexOf(t)+1;return e}function p(){return b.current?17*(b.getRank(b.current)-2):0}function f(t){b.current=t,m()}function m(){t.go("app.index.indicator",{iso:b.current.iso}),n(function(){h()})}function g(t,e){var n=i.getNationByIso(t.feature.properties[i.data.iso2]);"undefined"!=typeof n.score?(b.current=n,m()):c.error("No info about this location!")}function h(){o.getIndicatorHistory(b.indicator.id,b.current.iso,b.gender).then(function(t){b.historyData=t})}function v(e){b.year=e,n(function(){t.go("app.index.indicator",{year:e})},250)}function y(e){b.gender=e||"all",n(function(){t.go("app.index.indicator",{gender:b.gender})},250)}function x(e,n){o.getIndicatorData(b.indicator.id,b.year,b.gender).then(function(e){l(),b.data=e;var n=null;if(t.params.iso)for(var r=0;r<b.data.length;r++)b.data[r].iso==t.params.iso&&(b.current=b.data[r],n=b.current.iso);angular.forEach(b.data,function(t){t.rank=b.data.indexOf(t)+1,b.current&&t.iso==b.current.iso&&f(t),b.range.max=d3.max([b.range.max,parseFloat(t.score)]),b.range.min=d3.min([b.range.min,parseFloat(t.score)])}),b.circleOptions={color:b.indicator.styled.base_color||"#00ccaa",field:"rank",size:b.data.length},p(),b.linearScale=d3.scale.linear().domain([b.range.min,b.range.max]).range([0,256]),i.setData(b.data,b.indicator.styled.base_color,!0)})}function C(t){var e={},n=t.properties[i.data.iso2],r=i.getNationByIso(n),a="score",o=t.type;switch(t.selected=!1,b.current&&b.current.iso==n&&(t.selected=!0),o){case 3:if("undefined"!=typeof r[a]&&null!=r[a]){var c=4*parseInt(b.linearScale(parseFloat(r[a]))),s="rgba("+i.palette[c]+", "+i.palette[c+1]+", "+i.palette[c+2]+","+i.palette[c+3]+")";e.color="rgba("+i.palette[c]+", "+i.palette[c+1]+", "+i.palette[c+2]+",0.6)",e.outline={color:s,size:1},e.selected={color:"rgba("+i.palette[c]+", "+i.palette[c+1]+", "+i.palette[c+2]+",0.3)",outline:{color:"rgba(66,66,66,0.9)",size:2}}}else e.color="rgba(255,255,255,0)",e.outline={color:"rgba(255,255,255,0)",size:1}}return e}var b=this;b.current=null,b.active=null,b.activeGender=null,b.countryList=a,b.indicator=r,b.data=[],b.year=null,b.gender="all",b.range={max:-1e8,min:1e8},b.getData=x,
b.getOffset=p,b.getRank=d,b.goInfoState=u,b.historyData=null,b.setCurrent=f,b.setYear=v,b.setGender=y,s(),b.uiOnParamsChanged=function(t,e){x(b.year,b.gender)}}])}(),function(){"use strict";angular.module("app.controllers").controller("IndicatorYearTableCtrl",["$filter","data",function(t,e){function n(e){return a.data=t("orderBy")(a.data,[e],!0)}function r(t,e){}var a=this;a.data=e,a.onOrderChange=n,a.onPaginationChange=r}])}(),function(){"use strict";angular.module("app.controllers").controller("LoginCtrl",["$rootScope","$state","$auth","toastr",function(t,e,n,r){function a(){c.checkLoggedIn()}function o(){n.isAuthenticated()}function i(){n.login(c.user).then(function(n){r.success("You have successfully signed in"),console.log(t.previousPage),e.go(t.previousPage.state.name||"app.home",t.previousPage.params)})["catch"](function(t){r.error("Please check your email and password","Something went wrong")})}var c=this;c.prevState=null,c.doLogin=i,c.checkLoggedIn=o,c.user={email:"",password:""},a()}])}(),function(){"use strict";angular.module("app.controllers").controller("LogoCtrl",function(){})}(),function(){"use strict";angular.module("app.controllers").controller("MapCtrl",["$scope","$rootScope","$mdMenu","$state","leafletData","leafletMapEvents","VectorlayerService",function(t,e,n,r,a,o,i){function c(t){var e=i.getMap("map");console.log(e),l.noLabel?(e.removeLayer(l.labelsLayer),l.noLabel=!1):(e.addLayer(l.labelsLayer),l.labelsLayer.bringToFront(),l.noLabel=!0)}var s=3;window.innerWidth<600&&(s=2);var l=this,u=i.keys.mapbox;l.VectorlayerService=i,l.toggleLayers=c,l.labelsLayer=L.tileLayer("https://{s}.tiles.mapbox.com/v4/magnolo.06029a9c/{z}/{x}/{y}.png?access_token="+u,{noWrap:!0,continuousWorld:!1,name:"labels",detectRetina:!0}),l.maxbounds={southWest:{lat:90,lng:180},northEast:{lat:-90,lng:-180}},l.controls={custom:[]},l.layercontrol={icons:{uncheck:"fa fa-toggle-off",check:"fa fa-toggle-on"}};var d=L.control();d.setPosition("bottomright"),d.initialize=function(){L.Util.setOptions(this,options)},d.onAdd=function(){var t=L.DomUtil.create("div","leaflet-bar leaflet-control-zoom leaflet-toggle-label"),e=L.DomUtil.create("a","leaflet-control-zoom-in cursor",t);return e.textContent="T",e.title="Toggle Labels",L.DomEvent.disableClickPropagation(t),L.DomEvent.addListener(t,"click",function(){var t=i.getMap();l.noLabel?(t.removeLayer(l.labelsLayer),l.noLabel=!1):(t.addLayer(l.labelsLayer),l.labelsLayer.bringToFront(),l.noLabel=!0)}),t};var p=L.control();p.setPosition("bottomleft"),p.initialize=function(){L.Util.setOptions(this,options)},p.onAdd=function(){var t=L.DomUtil.create("div","leaflet-bar leaflet-control-zoom leaflet-control-home"),n=L.DomUtil.create("a","leaflet-control-zoom-in cursor",t),a=L.DomUtil.create("md-icon","material-icons md-primary",n);return n.title="Center Map",a.textContent="home",L.DomEvent.disableClickPropagation(t),L.DomEvent.addListener(t,"click",function(){var t=i.getMap();t.setView([48.209206,16.372778],2),r.$current.name.indexOf("app.export.detail.chapter.indicator")>-1&&(r.go("app.export.detail.chapter.indicator",{id:r.params.id,name:r.params.name,chapter:r.params.chapter,indicator:r.params.indicator,indiname:r.params.indiname},{reload:!0}),e.sidebarOpen=!1)}),t},a.getMap("map").then(function(t){i.setMap(t);var e="https://www.23degree.org:3001/services/postgis/"+i.getName()+"/geom/vector-tiles/{z}/{x}/{y}.pbf?fields="+i.fields(),n=new L.TileLayer.MVTSource({url:e,debug:!1,detectRetina:!0,clickableLayers:[i.getName()+"_geom"],mutexToggle:!0,getIDForLayerFeature:function(t){return t.properties.iso_a2},filter:function(t,e){return!0},style:function(t){var e={};return e.color="rgba(0,0,0,0)",e.outline={color:"rgba(0,0,0,0)",size:0},e}});t.addLayer(i.setLayer(n)),t.addControl(d),t.addControl(p)})}])}(),function(){"use strict";angular.module("app.controllers").controller("SelectedCtrl",["$scope","getCountry","VectorlayerService","$filter",function(t,e,n,r){function a(){var t=0;angular.forEach(s.data,function(t){t[s.structure.score_field_name]=parseFloat(t[s.structure.score_field_name]),t.score=parseInt(t.score)});for(var e=r("orderBy")(s.data,[s.structure.score_field_name,"score"],!0),n=0;n<e.length;n++)e[n].iso==s.current.iso&&(t=n+1);s.current[s.structure.score_field_name+"_rank"]=t,s.circleOptions={color:s.structure.color,field:s.structure.score_field_name+"_rank"}}function o(t){var e=r("orderBy")(s.data,[s.structure.score_field_name,"score"],!0),n=0;return angular.forEach(e,function(e,r){e.country==t.country&&(n=r)}),n+1}function i(){return s.current?16*(s.getRank(s.current)-2):0}function c(){return s.current&&s.current.percent_change>0?"arrow_drop_up":"arrow_drop_down"}var s=this;s.structure=t.$parent.vm.structure,s.display=t.$parent.vm.display,s.data=t.$parent.vm.data,s.current=e,s.mvtSource=n.getLayer(),s.getRank=o,s.getOffset=i,s.getTendency=c,t.$watch("vm.current",function(t,e){t!==e&&(e.iso&&(s.mvtSource.layers.countries_big_geom.features[e.iso].selected=!1),a(),fetchNationData(t.iso))})}])}(),function(){"use strict";angular.module("app.controllers").controller("SidemenuCtrl",function(){})}(),function(){"use strict";angular.module("app.controllers").controller("SignupCtrl",function(){})}(),function(){"use strict";angular.module("app.controllers").controller("UnsupportedBrowserCtrl",function(){})}(),function(){"use strict";angular.module("app.controllers").controller("UserCtrl",function(){})}(),function(){"use strict";angular.module("app.controllers").controller("AddProviderCtrl",["$scope","DialogService","DataService",function(t,e,n){var r=this;r.dataprovider={},r.dataprovider.title=t.$parent.vm.searchText,r.save=function(){n.post("/dataproviders",r.dataprovider).then(function(n){t.$parent.vm.dataproviders.push(n),t.$parent.vm.item.dataprovider=n,e.hide()})},r.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("AddUnitCtrl",["$scope","DataService","DialogService",function(t,e,n){var r=this;r.unit={},r.unit.title=t.$parent.vm.searchUnit,r.save=function(){e.post("/measure_types",r.unit).then(function(e){t.$parent.vm.measureTypes.push(e),t.$parent.vm.item.type=e,n.hide()})},r.hide=function(){n.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("AddYearCtrl",["$scope","DialogService",function(t,e){t.save=function(){console.log(t.vm),t.vm.saveData(),e.hide()},t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("AddUsersCtrl",["$scope","DialogService",function(t,e){t.save=function(){e.hide()},t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("ConflictmethodeCtrl",["$scope","DialogService",function(t,e){t.save=function(){},t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("CopyproviderCtrl",["$scope","IndexService","DialogService",function(t,e,n){t.$parent.vm.askedToReplicate=!0,t.$parent.vm.doProviders=!0,t.$parent.vm.doStyle=!0,t.$parent.vm.doCategories=!0,t.$parent.vm.doMeasures=!0,t.$parent.vm.doPublic=!0,t.save=function(){angular.forEach(t.$parent.vm.data[0].data,function(n,r){if("year"!=r){"undefined"==typeof e.getIndicator(r)&&e.setIndicator(r,{column_name:r,title:r});var a=e.getIndicator(r);t.$parent.vm.doProviders&&(a.dataprovider=t.$parent.vm.preProvider),t.$parent.vm.doMeasures&&(a.type=t.$parent.vm.preType),t.$parent.vm.doCategories&&(a.categories=t.$parent.vm.preCategories),t.$parent.vm.doPublic&&(a.is_public=t.$parent.vm.prePublic),t.$parent.vm.doStyle&&"undefined"!=typeof a.style&&(a.style=t.$parent.vm.preStyle,a.style_id=t.$parent.vm.preStyle.id)}}),n.hide(),e.setToLocalStorage()},t.hide=function(){t.$parent.vm.doProviders=!1,t.$parent.vm.doCategories=!1,t.$parent.vm.doMeasures=!1,n.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("EditcolumnCtrl",["$scope","DialogService",function(t,e){t.name=t.$parent.vm.toEdit,"undefined"==typeof t.$parent.vm.meta.table[t.name]?t.$parent.vm.meta.table[t.name]={}:(t.$parent.vm.meta.table[t.name].title&&(t.title=t.$parent.vm.meta.table[t.name].title),t.$parent.vm.meta.table[t.name].description&&(t.description=t.$parent.vm.meta.table[t.name].description)),t.save=function(){t.$parent.vm.meta.table[t.name].title=t.title,t.$parent.vm.meta.table[t.name].description=t.description,e.hide()},t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("EditrowCtrl",["$scope","DialogService",function(t,e){t.data=t.$parent.vm.selected[0],t.save=function(){e.hide()},t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("EmbedcodeCtrl",["$scope","$sce","DialogService",function(t,e,n){t.vm.url=e.trustAsResourceUrl("https://dev.23degree.org/#/export/"+t.vm.item.id+"/"+t.vm.item.name),t.save=function(){console.log(t.vm)},t.hide=function(){n.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("ExportDialogCtrl",["$scope","DialogService",function(t,e){console.log(t),t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("ExportdataCtrl",["$scope","DialogService",function(t,e){t.save=function(){},t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("ConflicttextCtrl",["$scope","DialogService",function(t,e){t.save=function(){},t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("ExtendDataCtrl",["$scope","$state","DialogService",function(t,e,n){t.save=function(){t.vm.doExtend=!0,t.vm.meta.iso_field=t.vm.addDataTo.iso_name,t.vm.meta.country_field=t.vm.addDataTo.country_name,e.go("app.index.check"),n.hide()},t.hide=function(){e.go("app.index.check"),n.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("GradientLabelsCtrl",["$scope","DialogService",function(t,e){t.save=function(){},t.hide=function(){e.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("SelectisofetchersCtrl",["$scope","IndexService","DialogService",function(t,e,n){var r=this,a=e.getMeta();r.iso=a.iso_field,r.list=e.getToSelect(),r.save=function(){n.hide()},r.hide=function(){n.hide()},t.$watch("vm.list",function(t,a){t!==a&&(angular.forEach(t,function(t,n){t.entry.data[0][r.iso]&&(angular.forEach(t.entry.errors,function(n,a){2==n.type||3==n.type?(e.reduceIsoError(),t.entry.errors.splice(a,1)):1==n.type&&n.column==r.iso&&(e.reduceError(),t.entry.errors.splice(a,1))}),r.list.splice(n,1))}),0==r.list.length&&n.hide())},!0)}])}(),function(){"use strict";angular.module("app.directives").directive("autoFocus",["$timeout",function(t){return{restrict:"AC",link:function(e,n){t(function(){n[0].focus()},0)}}}])}(),function(){"use strict";angular.module("app.controllers").controller("LoosedataCtrl",["$scope","$state","DialogService",function(t,e,n){t.save=function(){t.vm.deleteData(),e.go(t.toState.name),n.hide()},t.hide=function(){n.hide()}}])}(),function(){"use strict";angular.module("app.controllers").controller("BarsCtrl",function(){function t(t){if(e.data)return e.data[t.name]}var e=this;e.width=t})}(),function(){"use strict";angular.module("app.directives").directive("bars",function(){return{restrict:"EA",templateUrl:"views/directives/bars/bars.html",controller:"BarsCtrl",controllerAs:"vm",scope:{},bindToController:{data:"=",options:"=",structure:"="},link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("BasemapCtrl",function(){function t(t){var n=!1;return"undefined"!=typeof e.item.url&&("object"==typeof t?angular.forEach(t,function(t){e.item.url.indexOf(t)>-1&&(n=!0)}):e.item.url.indexOf(t)>-1&&(n=!0),n)}var e=this;e.original=angular.copy(e.item),e.containsSpecial=t,e.baseOptions={drag:!1,allowDrop:!1,allowDrag:!1,allowMove:!1,allowDelete:!1,allowAddContainer:!1,allowAdd:!1,allowSave:!0,editable:!1,assigments:!1,saveClick:e.options.save,deleteClick:e.options.deleteClick}})}(),function(){"use strict";angular.module("app.directives").directive("basemap",function(){return{restrict:"EA",templateUrl:"views/directives/basemap/basemap.html",controller:"BasemapCtrl",controllerAs:"vm",scope:{item:"=",options:"="},bindToController:!0,replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("BasemapSelectorCtrl",["BasemapsService","VectorlayerService",function(t,e){function n(){o.style||(o.style={basemap_id:0}),t.getBasemaps(function(t){o.basemaps=t,0!=o.style.basemap_id&&angular.forEach(o.basemaps,function(t,e){t.id==o.style.basemap_id&&(o.selected=t)})})}function r(t){o.selected=t,o.style.basemap_id=t.id,o.style.basemap=t}function a(t){return{url:t.url,attribution:t.attribution,type:"xyz"}}var o=this;o.basemaps=[],o.selected={},o.setMap=r,o.viewTiles=a,o.defaults={scrollWheelZoom:!1,minZoom:1,maxZoom:8,zoomControl:!1},o.center=e.center,o.maxbounds=e.maxbounds,n()}])}(),function(){"use strict";angular.module("app.directives").directive("basemapSelector",function(){return{restrict:"EA",templateUrl:"views/directives/basemapSelector/basemapSelector.html",controller:"BasemapSelectorCtrl",controllerAs:"vm",scope:{style:"=ngModel"},bindToController:!0,replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("CategoriesCtrl",["$filter","toastr","DataService",function(t,e,n){var r=this;r.catOptions={abort:function(){r.createCategory=!1},postDone:function(t){r.createCategory=!1}}}])}(),function(){"use strict";angular.module("app.directives").directive("categories",function(){return{restrict:"E",templateUrl:"views/directives/categories/categories.html",controller:"CategoriesCtrl",controllerAs:"vm",scope:{},bindToController:{item:"=",categories:"=",options:"=",save:"&"},replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("BubblesCtrl",function(){})}(),function(){"use strict";function t(t,e){function n(e,n,r,o){return angular.element(document.querySelector("#"+t)).html(e),angular.element(document.querySelector("#"+t)).css("display","block"),a(r,n,o)}function r(){angular.element(document.querySelector("#"+t)).css("display","none")}function a(e,n,r){var a="#"+t,o=r.find("svg")[0],i=(window.scrollY,angular.element(document.querySelector(a)).offsetWidth,document.querySelector(a).offsetHeight),c=o.getBoundingClientRect().top+n.y-i/2,s=o.getBoundingClientRect().left+n.x+n.radius+12;return angular.element(document.querySelector(a)).css("top",c+"px").css("left",s+"px")}var t=t,o=document.getElementById(t);return null==o&&angular.element(document).find("body").append("<div class='tooltip md-whiteframe-z3' id='"+t+"'></div>"),r(),{showTooltip:n,hideTooltip:r,updatePosition:a}}angular.module("app.directives").directive("bubbles",["$compile","IconsService",function(e,n){var r;return r=function(){return{width:300,height:300,layout_gravity:0,sizefactor:3,vis:null,force:null,damper:.085,circles:null,borders:!0,labels:!0,fill_color:d3.scale.ordinal().domain(["eh","ev"]).range(["#a31031","#beccae"]),max_amount:"",radius_scale:"",duration:1e3,tooltip:t("bubbles_tooltip",240)}},{restrict:"E",scope:{chartdata:"=",direction:"=",gravity:"=",sizefactor:"=",indexer:"=",borders:"@"},require:"ngModel",link:function(t,a,o,i){var c=angular.extend(r(),o),s=[],l=[],u=[],d=d3.max(t.chartdata,function(t){return parseFloat(t.value)});c.radius_scale=d3.scale.pow().exponent(.5).domain([0,d]).range([2,85]),c.center={x:c.width/2,y:c.height/2},c.cat_centers={};var p=function(){if(2==t.indexer.children.length&&t.indexer.children[0].children.length>0)angular.forEach(t.indexer.children,function(e,r){var a=e.color;0!=e.style_id&&(a=e.style.base_color);var o={type:e.name,name:e.title,group:e.name,color:a,icon:e.icon,unicode:n.getUnicode(e.icon),data:e,children:e.children};u.push(o),angular.forEach(e.children,function(r){if(t.chartdata[r.name]){var a=r.color;0!=r.style_id?a=r.style.base_color:0!=e.style_id&&(a=e.style.base_color);var o={type:r.name,radius:t.chartdata[r.name]/t.sizefactor,value:t.chartdata[r.name],name:r.title,group:e.name,x:c.center.x,y:c.center.y,color:a,icon:r.icon,unicode:n.getUnicode(r.icon),data:r,children:r};s.push(o)}})}),m();else{var e={type:t.indexer.name,name:t.indexer.title,group:t.indexer.name,color:t.indexer.style.base_color||t.indexer.color,icon:t.indexer.icon,unicode:t.indexer.unicode,data:t.indexer.data,children:t.indexer.children};u.push(e),angular.forEach(t.indexer.children,function(e){if(t.chartdata[e.name]){var r={type:e.name,radius:t.chartdata[e.name]/t.sizefactor,value:t.chartdata[e.name]/t.sizefactor,name:e.title,group:t.indexer.name,x:c.center.x,y:c.center.y,color:e.color,icon:e.icon,unicode:n.getUnicode(e.icon),data:e,children:e};s.push(r)}})}},f=function(){s=[],u=[]},m=function(){angular.forEach(s,function(t,e){c.cat_centers[t.group]={x:c.width/2,y:c.height/2+(1-e),damper:.085}})},g=function(){if(angular.element(a).html(""),c.vis=d3.select(a[0]).append("svg").attr("width",c.width).attr("height",c.height).attr("id","svg_vis"),!c.borders){var t=Math.PI;if(2==u.length){var e=d3.svg.arc().innerRadius(109).outerRadius(110).startAngle(-90*(t/180)).endAngle(90*(t/180)),n=d3.svg.arc().innerRadius(134).outerRadius(135).startAngle(90*(t/180)).endAngle(270*(t/180));c.arcTop=c.vis.append("path").attr("d",e).attr("fill",function(t){return u[0].color||"#be5f00"}).attr("id","arcTop").attr("transform","translate("+c.width/2+","+(c.height/2-c.height/12)+")"),c.arcBottom=c.vis.append("path").attr("d",n).attr("id","arcBottom").attr("fill",function(t){return u[1].color||"#006bb6"}).attr("transform","translate("+c.width/2+","+c.height/2+")")}else{var r=d3.svg.arc().innerRadius(c.width/3-1).outerRadius(c.width/3).startAngle(0*(t/180)).endAngle(360*(t/180));c.arc=c.vis.append("path").attr("d",r).attr("fill",u[0].color).attr("id","arcTop").attr("transform","translate("+c.width/2+","+c.height/2+")")}}if(1==c.labels&&2==u.length){c.vis.selectAll("text.labels").data(u).enter().append("text").attr("class","labels").attr("fill",function(t){return t.color}).attr("x","50%").style("font-size","1.2em").style("cursor","pointer").attr("width",c.width).attr("text-anchor","middle").on("click",function(t){i.$setViewValue(t.data),i.$render()}).attr("y",function(t){var e=u.indexOf(t);return 0==e?15:c.height-6}).text(function(t){return t.name})}c.containers=c.vis.selectAll("g.node").data(s).enter().append("g").attr("transform","translate("+c.width/2+","+c.height/2+")").attr("class","node"),c.circles=c.containers.append("circle").attr("r",0).attr("fill",function(t){return t.color||c.fill_color(t.group)}).attr("stroke-width",0).attr("stroke",function(t){return d3.rgb(c.fill_color(t.group)).darker()}).attr("id",function(t){return"bubble_"+t.type}),c.icons=c.containers.append("text").attr("font-family","EPI").attr("font-size",function(t){}).attr("text-anchor","middle").attr("fill",function(t){return t.unicode?"#fff":t.color}).style("opacity",function(t){return t.unicode?1:0}).text(function(t){return t.unicode||"1"}),c.icons.on("mouseover",function(t,e){return S(t,e,this)}).on("mouseout",function(t,e){return _(t,e,this)}).on("click",function(t,e){i.$setViewValue(t.data),i.$render()}),c.circles.transition().duration(c.duration).attr("r",function(t){return t.radius}),c.icons.transition().duration(c.duration).attr("font-size",function(t){return 1.75*t.radius+"px"}).attr("y",function(t){return.75*t.radius+"px"})},h=function(){s.forEach(function(e,n){c.circles.transition().duration(c.duration).delay(n*c.duration).attr("r",function(e){return e.radius=e.value=t.chartdata[e.type]/t.sizefactor,t.chartdata[e.type]/t.sizefactor}),c.icons.transition().duration(c.duration).delay(n*c.duration).attr("font-size",function(e){return t.chartdata[e.type]/t.sizefactor*1.75+"px"}).attr("y",function(e){return t.chartdata[e.type]/t.sizefactor*.75+"px"})})},v=function(t){return-Math.pow(t.radius,2)/4},y=function(){return c.force=d3.layout.force().nodes(s).size([c.width,c.height]).links(l)},x=function(){c.force.gravity(c.layout_gravity).charge(v).friction(.85).on("tick",function(t){c.containers.each(b(t.alpha)).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),c.force.start()},C=function(){c.force.gravity(c.layout_gravity).charge(v).friction(.9).on("tick",function(t){c.containers.each(w(t.alpha)).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),c.force.start()},b=function(t){return function(e){return function(e){e.x=e.x+(c.width/2-e.x)*(c.damper+.02)*t*1.25,e.y=e.y+(c.height/2-e.y)*(c.damper+.02)*t*1.25}}(this)},w=function(t){return function(e){return function(e){var n;return n=c.cat_centers[e.group],e.x=e.x+(n.x-e.x)*(n.damper+.02)*t*1,e.y=e.y+(n.y-e.y)*(n.damper+.02)*t*1}}(this)},S=function(n,r,o){var i;i='<md-progress-linear md-mode="determinate" value="'+n.value+'"></md-progress-linear>',i+='<span class="title">'+n.name+"</span><br/>",angular.forEach(n.data.children,function(e){t.chartdata[e.name]>0&&(i+='<div class="sub">',i+='<md-progress-linear md-mode="determinate" value="'+t.chartdata[e.name]+'"></md-progress-linear>',i+='<span class="name" style="color:'+(e.color||n.color)+'"> '+t.chartdata[e.name]+" - "+e.title+"</span><br/>",i+="</div>")}),e(c.tooltip.showTooltip(i,n,d3.event,a).contents())(t)},_=function(t,e,n){return c.tooltip.hideTooltip()};t.$watch("chartdata",function(t,e){c.tooltip.hideTooltip(),null==c.circles?(p(),g(),y()):h(),1==u.length||1!=c.labels?x():C()}),t.$watch("indexer",function(t,e){t!==e&&"undefined"!=typeof t[0].children&&(c.tooltip.hideTooltip(),f(),p(),g(),y(),1==u.length||1!=c.labels,x())}),t.$watch("direction",function(t,e){t!==e&&("all"==t?x():C())})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("CategoryCtrl",["$scope","$filter","toastr","DataService","ContentService",function(t,e,n,r,a){function o(){i(m.categories),m.item.parent_id&&(m.parent=u(m.item,m.categories),m.copy=angular.copy(m.item))}function i(t){angular.forEach(t,function(t){m.flattened.push(t),t.children&&i(t.children)})}function c(t){return e("findbyname")(e("orderBy")(m.flattened,"title"),t,"title")}function s(){return!!(m.item.title&&m.item.title.length>=3)}function l(t){return"undefined"==typeof t?(m.item.parent_id=null,m.item.parent=null,!1):t.id==m.item.id?(n.error("The Parent cannot be the same","Invalid selection"),!1):(m.parent=t,m.item.parent_id=t.id,void(m.item.parent=t))}function u(t,e){var n=null;return angular.forEach(e,function(e,r){if(e.id==t.parent_id&&(n=e),e.children&&!n){var a=u(t,e.children);a&&(n=a)}}),n}function d(){if(m.copy.parent_id)for(var t=u(m.copy,m.categories),e=0;e<t.children.length;e++)t.children[e].id==m.item.id&&t.children.splice(e,1);else for(var e=0;e<m.categories.length;e++)m.categories[e].id==m.item.id&&m.categories.splice(e,1);if(m.item.parent_id){var n=u(m.item,m.categories);n.children.push(m.item)}else m.categories.push(m.item)}function p(e){console.log(m.copy.parent_id,m.item.parent_id),m.copy.parent_id!=m.item.parent_id&&d(),n.success("Category has been updated","Success"),t.categoryForm.$setSubmitted(),m.copy=angular.copy(m.item)}function f(t){t&&(m.item.id?m.item.restangularized?m.item.save().then(p):r.update("categories",m.item.id,m.item).then(p):r.post("categories",m.item).then(function(t){if(t.parent_id){var e=u(t,m.categories);e.children||(e.children=[]),e.children.push(t),e.expanded=!0}else m.categories.push(t);n.success("New Category has been saved","Success"),m.options.postDone(t)}))}var m=this;m.saveCategory=f,m.querySearchCategory=c,m.parentChanged=l,m.checkBase=s,m.styles=a.getStyles(),m.flattened=[],m.copy={},o()}])}(),function(){"use strict";angular.module("app.directives").directive("category",function(){return{restrict:"EA",templateUrl:"views/directives/category/category.html",controller:"CategoryCtrl",controllerAs:"vm",scope:{},bindToController:{item:"=",categories:"=",options:"=?",save:"&"},replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("CirclegraphCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("circlegraph",["$timeout",function(t){var e=function(){return{width:80,height:80,color:"#00ccaa",size:178,field:"rank"}};return{restrict:"E",controller:"CirclegraphCtrl",scope:{options:"=",item:"="},link:function(n,r,a){function o(t){u.transition().duration(750).attr("stroke",n.options.color),p.transition().duration(750).style("fill",n.options.color).call(i,2*c(t)*Math.PI),f.transition().duration(750).tween("text",function(e){if(n.options.hideNumbering){var r=this.textContent.split("/"),a=d3.interpolate(parseInt(r[0]),t);return function(t){this.textContent=Math.round(1*a(t))/1+"/"+n.options.size}}var r=this.textContent.split("N°"),a=d3.interpolate(parseInt(r[1]),t);return function(t){this.textContent="N°"+Math.round(1*a(t))/1}}).style("fill",n.options.color)}function i(t,e){t.attrTween("d",function(t){var n=d3.interpolate(t.endAngle,e);return function(e){return t.endAngle=n(e),d(t)}})}n.options=angular.extend(e(),n.options);var c=(2*Math.PI,d3.scale.linear().domain([1,n.options.size]).range([1,0]).clamp(!0)),s=d3.select(r[0]).append("svg").attr("width",n.options.width).attr("height",n.options.height).append("g"),l=s.append("g").attr("transform","translate("+n.options.width/2+","+n.options.height/2+")").style("font-size",function(){return n.options.fontSize?n.options.fontSize+"px":"1em"}),u=l.append("circle").attr("r",n.options.width/2-2).attr("stroke-width",2).attr("stroke",n.options.color).style("opacity","0.6").attr("fill","none"),d=d3.svg.arc().startAngle(0).innerRadius(function(t){return n.options.width/2-4}).outerRadius(function(t){return n.options.width/2}),p=l.append("path").datum({endAngle:2*Math.PI*0}).style("fill",n.options.color).attr("d",d),f=l.selectAll("text").data([0]).enter().append("text").text(function(t){return n.options.hideNumbering?t+"/"+n.options.size:"N°"+t}).style("fill",n.options.color).style("font-weight","bold").style("font-size",function(){return"1em"}).attr("text-anchor","middle").attr("y",function(t){return"0.35em"});n.$watch("item",function(e,r){e||(e[n.options.field]=n.options.size),t(function(){o(e[n.options.field])})}),n.$watch("options",function(e,r){e!==r&&e&&t(function(){o(n.item[n.options.field])})},!0)}}}])}(),function(){"use strict";angular.module("app.controllers").controller("ColorGradientCtrl",["$scope",function(t){function e(t){n.gradient.splice(t,1)}var n=this;n.removeColor=e,n.active,n.dragEvents={dragMove:function(t,e,r){var a=100*t.position.x/t.containerSize.width;n.active.pos=a},dragEnd:function(t,e,n){}}}])}(),function(){"use strict";angular.module("app.directives").directive("colorGradient",function(){return{restrict:"EA",templateUrl:"views/directives/color-gradient/color-gradient.html",controller:"ColorGradientCtrl",controllerAs:"vm",scope:{},bindToController:{gradient:"="},link:function(t,e,n){function r(){var e=s.selectAll("stop").data(t.vm.gradient,function(t){return t.id});e.enter().append("stop").attr("offset",function(t){return console.log(t.pos),t.pos+"%"}).style("stop-color",function(t){return t.color}),e.exit().remove()}var a=e.parent()[0].clientWidth-48,o=20,i=d3.select(e[0]).append("svg");i.attr("width",a).attr("height",o);var c=i.append("defs"),s=c.append("linearGradient").attr("id","gradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");i.append("rect").attr("width",a).attr("height",o).style("fill","url(#gradient)");t.$watch("vm.gradient",function(t,e){return 0!==t&&void r()},!0),r()}}})}(),function(){"use strict";angular.module("app.controllers").controller("ColorHandleCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("colorHandle",["$document","$timeout",function(t,e){return function(n,r,a){var o,i,c,s;return i=r.parent(),c=function(){return n.$eval(a.colorHandle)},n.$watch(a.colorHandle,function(t,e){var a,o,i;return o=-3.4,i=96.7,r.css("left",o+t.stop*(i+Math.abs(o))+"%"),null!==t.color?r.css("color",t.color):(a=n.vm.deleteColorHandle(t))?void 0:t.color=e.color},!0),s=null,r.bind("mousedown",function(t){var e;if(e=1===t.which)return o()}),o=function(){var e;if(e=c(),r.addClass("dragging"),!s)return t.bind("mousemove",s=function(t){return n.$apply(function(){return e.stop=(t.pageX-i[0].getBoundingClientRect().left)/i[0].clientWidth,e.stop<0?e.stop=0:e.stop>1?e.stop=1:void 0})})},t.bind("mouseup",function(){if(r.hasClass("dragging")&&r.removeClass("dragging"),null!==s)return t.unbind("mousemove",s),s=null}),r.bind("mouseup",function(){var t;if(t=3===event.which)return n.$apply(function(){return n.vm.deleteColorHandle(c())})}),e(function(){var t;t=c()})}}])}(),function(){"use strict";angular.module("app.controllers").controller("CompareCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("compareCountries",["$document","$timeout",function(t,e){var n=function(){return{width:350,height:25,margin:5,color:"#ff0000",field:"score",duration:500,min:0,max:100}};return{restrict:"EA",templateUrl:"views/directives/compare/compare.html",controller:"CompareCtrl",scope:{countries:"=",country:"=",options:"="},link:function(t,r,a){function o(){l.transition().duration(t.options.duration).attr("height",t.options.height*t.countries.length+2*t.options.height),s.domain([0,t.countries.length]).range([0,t.options.height*t.countries.length]),d3.transition(l).select(".x.axis").call(d).attr("transform","translate(100,20)");var e=h.selectAll(".bar").data(t.countries,function(t){return"id_"+t.iso}),n=e.enter().insert("g",".axis").attr("class","bar"),r=n.append("rect").attr("height",t.options.height-t.options.margin).style("fill",i).attr("width",function(t){return 0}),a=(n.append("text").attr("class","ranks").attr("transform","translate(-70, 0)").text(function(t){return 1==t.rank?"1st":2==t.rank?"2nd":t.rank+"th"}).attr("fill",t.options.color).attr("y",function(e){return 3*t.options.margin}),n.append("rect").attr("height",t.options.height-t.options.margin).style("fill",function(e){return e.iso==t.country.iso?t.options.color:i}).attr("width",function(e){return t.options.height}).attr("x",-(t.options.height+t.options.margin)),n.append("text").attr("class","label").attr({x:function(t,e){return-17},y:function(e,n){return 2*t.options.margin}}).style("font-size","13px").attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.iso}).attr("fill",function(e){return e.iso==t.country.iso?"#fff":t.options.color}),n.append("text").attr("class","value").attr({x:0,y:2*t.options.margin}).text(0).style("fill",t.options.color).attr("dy",".35em").attr("text-anchor","end")),o=n.append("circle").attr("r",3).attr("cx",0).attr("cy",t.options.height/2-t.options.margin/2).attr("fill",t.options.color);d3.transition(e).attr("transform",function(e,n){return"translate(0,"+(n*t.options.height+t.options.margin/2+20)+")"});f.transition().duration(t.options.duration).attr("y2",t.options.height*t.countries.length),m.transition().duration(t.options.duration).attr("y2",t.options.height*t.countries.length),g.transition().duration(t.options.duration).attr("y2",t.options.height*t.countries.length),r.transition().duration(t.options.duration).attr("width",function(e){return c(e[t.options.field])}),o.transition().duration(t.options.duration).attr("cx",function(e){return c(e[t.options.field])}),a.transition().duration(t.options.duration).attr({x:function(e,n){return e[t.options.field]>t.options.max/2?c(e[t.options.field])-this.getBoundingClientRect().width:c(e[t.options.field])+t.options.height}}).tween("text",function(e){var n=d3.interpolate(this.textContent,parseInt(e[t.options.field]));return function(t){this.textContent=Math.round(n(t))}}),e.exit().transition().duration(t.options.duration).attr("opacity","0").remove()}t.options=angular.extend(n(),t.options),t.options.width=r[0].clientWidth-20;var i="#ddd",c=d3.scale.linear().domain([t.options.min,t.options.max]).range([0,t.options.width-100-2*t.options.margin]),s=d3.scale.ordinal().range([0,t.options.height]).domain([0,t.countries.length]),l=d3.select(r[0]).append("svg").attr("width",t.options.width).attr("height",t.options.height*t.countries.length),u=l.append("g").attr("id","compare-chart").attr("y",t.options.height).attr("x",t.options.margin),d=d3.svg.axis().scale(c).orient("top").tickValues([t.options.min,t.options.max]),p=l.append("g").attr("class","x axis"),f=p.append("line").attr("class","domain").attr("y2",t.options.height*t.countries.length),m=p.append("line").attr("class","domain dashed").attr("transform",function(){
return"translate("+c(t.options.max/2)+",0)"}).attr("y2",t.options.height*t.countries.length),g=p.append("line").attr("class","domain").attr("transform",function(){return"translate("+c(t.options.max)+",0)"}).attr("y2",t.options.height*t.countries.length),h=(p.append("text").attr("class","header").text("Rank").attr("transform",function(){return"translate(-85,-10)"}),p.append("text").attr("class","header").text("Median").attr("transform",function(){return"translate("+(t.options.width/2-75)+",-10)"}),u.append("g").attr("id","bars").attr("transform","translate(100,0)"));u.append("g").attr("id","labels").attr("width",t.options.max);t.$watch(function(){return t.countries},function(n,r){t.countries=angular.extend(t.countries,t.country),o(),e(function(){var e=angular.element(document).find("md-sidenav").find("section");angular.element(document.getElementById("map"));if(t.countries.length&&window.innerWidth<960){var n=e[0].clientHeight;n<window.innerHeight-194?e.attr("style","transform:translateY(calc(100vh - "+parseInt(24*t.countries.length)+"px - 260px))"):e.attr("style","transform:translateY(calc(100vh - "+parseInt(window.innerHeight-200)+"px - 40px))")}else e.attr("style","")})},!0)}}}])}(),function(){"use strict";angular.module("app.controllers").controller("CompositsCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("composits",function(){return{restrict:"EA",templateUrl:"views/directives/composits/composits.html",controller:"CompositsCtrl",controllerAs:"vm",scope:{},bindToController:{items:"=",item:"=",options:"="},replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("ConflictitemsCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("conflictitems",function(){return{restrict:"EA",templateUrl:"views/directives/conflictitems/conflictitems.html",controller:"ConflictitemsCtrl",link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("ContenteditableCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(t,e,n,r){function a(){var t=e.html();n.stripBr&&"<br>"==t&&(t=""),r.$setViewValue(t)}r.$render=function(){e.html(r.$viewValue||"")},e.on("blur keyup change",function(){t.$apply(a)})}}})}(),function(){"use strict";angular.module("app.directives").directive("export",function(){return{restrict:"EA",templateUrl:"views/directives/export/export.html",controller:"ExportDirectiveCtrl",controllerAs:"vm",scope:{item:"=",options:"=",selected:"="},bindToController:!0,replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("ExportDirectiveCtrl",["$scope","DataService","DialogService",function(t,e,n){function r(){}function a(){}function o(){}function i(){n.fromTemplate("embedcode",t)}var c=this;c.original=angular.copy(c.item),c.checkBase=a,c.checkFull=o,c.getCode=i,c.baseOptions={drag:!0,allowDrop:!0,allowDrag:!0,allowMove:!0,allowSave:!0,allowDelete:!0,allowAddContainer:!0,allowAdd:!0,editable:!0,assigments:!1,saveClick:c.options.exports.save,addClick:c.options.exports.addClick,addContainerClick:c.options.exports.addContainerClick,deleteDrop:c.options.exports.deleteDrop,deleteClick:c.options.exports.deleteClick,onDrop:c.options.exports.onDrop,inserted:c.options.exports.inserted,styleable:c.options.styleable,styleClick:c.options.style.click,hideExpansionOnItem:!0,expandJustGroups:c.options.expandJustGroups},r()}])}(),function(){"use strict";angular.module("app.directives").directive("exportChooser",function(){return{restrict:"EA",templateUrl:"views/directives/exportChooser/exportChooser.html",controller:"ExportChooserCtrl",controllerAs:"vm",scope:{countries:"=",nation:"=",selected:"=?",chapters:"=?",changed:"&",indicatorChange:"&?"},bindToController:!0,replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("ExportChooserCtrl",["$scope","$timeout",function(t,e){var n=this;n.index=0,n.activeList=[],e(function(){n.chapters&&(n.selected.parent_id?angular.forEach(n.chapters,function(t){t.id==n.selected.parent_id&&(n.activeList=t.children)}):n.activeList=n.chapters,n.index=n.activeList.indexOf(n.selected))}),t.$watch("vm.index",function(t,e){return t!==e&&void(n.selected=n.activeList[n.index])})}])}(),function(){"use strict";angular.module("app.directives").directive("fileDropzone",["toastr",function(t){return{restrict:"EA",scope:{file:"=",fileName:"="},link:function(e,n,r){var a,o,i,c;return i=function(t){return null!=t&&t.preventDefault(),t.dataTransfer.effectAllowed="copy",!1},c=r.fileDropzone,a=function(t){var e;return void 0===(e=r.maxFileSize)||""===e||t/1024/1024<r.maxFileSize||(alert("File must be smaller than "+r.maxFileSize+" MB"),!1)},o=function(e){return void 0===c||""===c||c.indexOf(e)>-1||(t.error("File must be one of following types "+c,"Invalid file type!"),!1)},n.bind("dragover",i),n.bind("dragenter",i),n.bind("drop",function(t){var n,r,i,c,s;return null!=t&&t.preventDefault(),i=new FileReader,i.onload=function(t){if(a(c)&&o(s))return e.$apply(function(){if(e.file=t.target.result,angular.isString(e.fileName))return e.fileName=r})},n=t.dataTransfer.files[0],e.file=n,!1})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("FileDropzoneCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("previewCanvas",function(){return{link:function(t,e,n,r){var a,o,i,c,s;return a=e[0],o=a.getContext("2d"),s=3,c=function(){return{ColorHandles:t.$eval(n.colorHandles),gradientType:t.$eval(n.gradientType),width:e.prop("width"),height:e.prop("height"),rotateDegrees:t.$eval(n.rotate),innerCircleX:t.$eval(n.innerCircleX),innerCircleY:t.$eval(n.innerCircleY),outerCircleX:t.$eval(n.outerCircleX),outerCircleY:t.$eval(n.outerCircleY)}},i=function(e){var r,a,i,c,l,u,d,p,f,m,g,h,v,y,x,C,b,w,S,_,I,$,E,D,k,L,A,T,O,z,M,F,U,P,R,B,N,G;switch(a=e.ColorHandles,u=e.gradientType,E=e.width,p=e.height,_=null!=(P=e.rotateDegrees)?P:0,f=null!=(R=e.innerCircleX)?R:50,m=null!=(B=e.innerCircleY)?B:50,h=null!=(N=e.outerCircleX)?N:50,v=null!=(G=e.outerCircleY)?G:50,n.htmlCode&&(t[n.htmlCode]='<canvas id="myPrettyCanvas" width="'+E+'" height="'+p+'"></canvas>'),n.jsCode&&(t[n.jsCode]="var canvasId = 'myPrettyCanvas',\n    canvas = document.getElementById(canvasId),\n    ctx = canvas.getContext('2d'),\n    grd;\n\n"),I=1,$=1,u){case"linear":0<=_&&_<45?(D=0,T=p/2*(45-_)/45,L=E,z=p-T):45<=_&&_<135?(D=E*(_-45)/90,T=0,L=E-D,z=p):135<=_&&_<225?(D=E,T=p*(_-135)/90,L=0,z=p-T):225<=_&&_<315?(D=E*(1-(_-225)/90),T=p,L=E-D,z=0):315<=_&&(D=0,T=p-p/2*(_-315)/45,L=E,z=p-T),d=o.createLinearGradient(D,T,L,z),n.jsCode&&(k=D.toFixed(s),O=T.toFixed(s),A=L.toFixed(s),M=z.toFixed(s),t[n.jsCode]+="// Create gradient\ngrd = ctx.createLinearGradient("+k+", "+O+", "+A+", "+M+");\n\n");break;case"radial":E>p&&($=p/E),p>E&&(I=E/p),o.setTransform(I,0,0,$,0,0),d=o.createRadialGradient(D=E*f/100/I,T=p*m/100/$,x=0,L=E*h/100/I,z=p*v/100/$,b=E/2/I),n.jsCode&&(1===I&&1===$||(t[n.jsCode]+="// Transform to facilitate ellipse\nctx.setTransform("+I+", 0, 0, "+$+", 0, 0);\n\n"),k=D.toFixed(s),O=T.toFixed(s),C=x.toFixed(s),A=L.toFixed(s),M=z.toFixed(s),w=b.toFixed(s),t[n.jsCode]+="// Create gradient\ngrd = ctx.createRadialGradient("+k+", "+O+", "+C+", "+A+", "+M+", "+w+");\n\n");break;default:throw"Unknown gradient type."}for(n.jsCode&&(t[n.jsCode]+="// Add colors\n"),F=0,U=a.length;F<U;F++)r=a[F],r.color&&(d.addColorStop(r.stop,r.color),n.jsCode&&(S=/([\d.]+),\s*([\d.]+),\s*([\d.]+),\s*([\d.]+)/,g=S.exec(r.color),y=g[1],l=g[2],c=g[3],i=parseFloat(g[4]).toFixed(s),t[n.jsCode]+="grd.addColorStop("+r.stop.toFixed(s)+", 'rgba("+y+", "+l+", "+c+", "+i+")');\n"));n.jsCode&&(t[n.jsCode]+="\n"),o.clearRect(0,0,E/I,p/$),o.fillStyle=d,o.fillRect(0,0,E/I,p/$),n.jsCode&&(t[n.jsCode]+="// Fill with gradient\nctx.fillStyle = grd;\nctx.fillRect(0, 0, "+(E/I).toFixed(s)+", "+(p/$).toFixed(s)+");")},t.$watch(c,i,!0)}}})}(),function(){"use strict";angular.module("app.controllers").controller("GradientCreatorCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("gradientClickArea",["$document",function(t){return{template:'<span class="addHandleIcon iconic brush"></span>',link:function(e,n){var r,a;return r=n.find("span").css("opacity",0),a=!1,t.bind("mousedown",function(){return a=!0}),t.bind("mouseup",function(){return a=!1}),n.bind("mouseover",function(){if(!a)return r.css("opacity",1)}),n.bind("mouseout",function(){return r.css("opacity",0)}),n.bind("mousemove",function(t){return r.css({left:t.offsetX,top:t.offsetY-5})}),n.bind("mousedown",function(t){var a;if(a=1===t.which)return e.$apply(function(){return e.vm.addColorHandle((t.pageX-n[0].getBoundingClientRect().left)/n[0].clientWidth)}),r.css("opacity",0)})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("GradientCreatorClickAreaCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("history",function(){var t=function(){return{field:"score",color:""}};return{restrict:"E",templateUrl:"views/directives/history/history.html",controller:"HistoryCtrl",scope:{options:"=",chartdata:"="},link:function(e,n,r,a){angular.extend(t(),e.options)}}})}(),function(){"use strict";angular.module("app.controllers").controller("HistoryCtrl",["$scope",function(t){function e(){t.setData(),t.$watch("options",function(e,n){0!==e&&t.setData()})}function n(){t.display={selectedCat:"",rank:[{fields:{x:"year",y:"rank"},title:"Rank",color:"#52b695"}],score:[{fields:{x:"year",y:t.options.field},title:"Score",color:t.options.color}]}}t.setData=n,e()}])}(),function(){"use strict";angular.module("app.directives").directive("imageColor",["$timeout",function(t){return{restrict:"EA",templateUrl:"views/directives/imageColor/imageColor.html",controller:"ImageColorCtrl",scope:{color:"="},link:function(t,e,n){function r(t){var e,n,r,a,o=5,i={r:0,g:0,b:0},c=document.createElement("canvas"),s=c.getContext&&c.getContext("2d"),l=-4,u={r:0,g:0,b:0},d=0;if(!s)return i;r=c.height=t.naturalHeight||t.offsetHeight||t.height,n=c.width=t.naturalWidth||t.offsetWidth||t.width,s.drawImage(t,0,0);try{e=s.getImageData(0,0,n,r)}catch(p){return alert("x"),i}for(a=e.data.length;(l+=4*o)<a;)++d,u.r+=e.data[l],u.g+=e.data[l+1],u.b+=e.data[l+2];return u.r=~~(u.r/d),u.g=~~(u.g/d),u.b=~~(u.b/d),u}var a=e[0];a.onload=function(){t.color=tinycolor(r(a)).isDark()}}}}])}(),function(){"use strict";angular.module("app.controllers").controller("ImageColorCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("imageUploader",function(){return{restrict:"EA",templateUrl:"views/directives/imageUploader/imageUploader.html",controller:"ImageUploaderCtrl",controllerAs:"vm",scope:{item:"=ngModel",label:"@"},bindToController:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("ImageUploaderCtrl",function(){function t(t,e,r){n.item||(n.item={});var a=JSON.parse(e);n.item.image=a,n.item.image_id=a.id}function e(t){t.cancel(),n.item.image=null,n.item.image_id=null}var n=this;n.assignImage=t,n.resetImage=e})}(),function(){"use strict";angular.module("app.directives").directive("indicator",function(){return{restrict:"EA",templateUrl:"views/directives/indicator/indicator.html",controller:"IndicatorCtrl",controllerAs:"vm",scope:{item:"=",options:"=",selected:"="},bindToController:!0,replace:!0,link:function(t,e,n,r){}}})}(),function(){"use strict";angular.module("app.controllers").controller("IndicatorCtrl",["$scope","DataService","ContentService","DialogService","$filter","toastr","VectorlayerService",function(t,e,n,r,a,o,i){function c(){u()}function s(t){return a("findbyname")(h.dataproviders,t,"title")}function l(t){return a("findbyname")(h.measureTypes,t,"title")}function u(){h.dataproviders=e.getAll("dataproviders").$object,h.categories=n.getCategories({tree:!0}),h.measureTypes=e.getAll("measure_types").$object,h.styles=e.getAll("styles").$object}function d(){return!!(h.item.title&&h.item.type&&h.item.dataprovider&&h.item.title.length>=3)}function p(){return"undefined"!=typeof h.item.categories&&!(!d()||!h.item.categories.length)}function f(){h.item.save().then(function(t){t&&(o.success("Data successfully updated!","Successfully saved"),h.item.isDirty=!1,h.original=angular.copy(h.item))})}function m(e){r.fromTemplate("addProvider",t)}function g(e){r.fromTemplate("addUnit",t)}var h=this;h.original=angular.copy(h.item),h.checkBase=d,h.checkFull=p,h.categories=[],h.dataproviders=[],h.selectedItem=null,h.searchText=null,h.searchUnit=null,h.querySearch=s,h.queryUnit=l,h.save=f,h.createProvider=m,h.createUnit=g,c(),t.$watch("vm.item",function(t,e){t!=e&&(h.item.isDirty=!angular.equals(h.item,h.original))},!0)}])}(),function(){"use strict";angular.module("app.directives").directive("indicatorMenu",function(){return{restrict:"EA",scope:{item:"=item"},replace:!0,templateUrl:"views/directives/indicatorMenu/indicatorMenu.html",controller:"IndicatorMenuCtrl",controllerAs:"vm",bindToController:!0,link:function(t,e,n){var r="active",a=(e[0],e.parent());a.on("mouseenter",function(t){e.addClass(r)}).on("mouseleave",function(t){e.removeClass(r)})}}})}(),function(){"use strict";angular.module("app.controllers").controller("IndicatorMenuCtrl",function(){function t(){return r.item.is_official?"lock_open":"lock"}function e(){r.item.is_official=!r.item.is_official,r.item.save()}function n(t){return!!(t.title&&t.measure_type_id&&t.dataprovider&&t.title.length>=3)}var r=this;r.checkBase=n,r.locked=t,r.changeOfficial=e})}(),function(){"use strict";angular.module("app.directives").directive("indicators",function(){return{restrict:"EA",templateUrl:"views/directives/indicators/indicators.html",controller:"IndicatorsCtrl",controllerAs:"vm",scope:{},bindToController:{item:"=?",indicators:"=items",selection:"=?",options:"=?",active:"=?"},replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("IndicatorsCtrl",["DataService",function(t){function e(t){c.visibleList==t?c.visibleList="":c.visibleList=t}function n(t){return c.selection.indexOf(t)>-1}function r(t){var e=c.selection.indexOf(t);return e>-1?c.selection.splice(e,1):c.selection.push(t)}function a(t){return c.selection.length?(c.selection=[],!1):(c.selection=[],void angular.forEach(t,function(t){c.selection.push(t)}))}function o(t,e){t(e)}function i(){c.selection.length&&(angular.forEach(c.selection,function(e){t.remove("indicators",e.id).then(function(t){c.indicators.splice(c.indicators.indexOf(e),1)})}),c.selection=[])}var c=this;c.selectAllGroup=a,c.selectedItem=n,c.toggleSelection=r,c.deleteSelected=i,c.filter={sort:"title",reverse:!1,list:0,published:!1,types:{title:!0,style:!1,categories:!1,infographic:!1,description:!1}},c.search={query:"",show:!1},c.openMenu=o,c.toggleList=e}])}(),function(){"use strict";angular.module("app.directives").directive("indizes",function(){return{restrict:"EA",templateUrl:"views/directives/indizes/indizes.html",controller:"IndizesCtrl",controllerAs:"vm",scope:{item:"=",options:"=",selected:"="},bindToController:!0,replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("IndizesCtrl",["$scope","$state","$filter","$timeout","toastr","DataService","ContentService",function(t,e,n,r,a,o,i){function c(){s()}function s(){p.categories=i.getCategories({tree:!0}),p.styles=o.getAll("styles").$object,p.types=o.getAll("index/types").$object,"undefined"==typeof p.item.id&&(p.item.item_type_id=1,p.item.children=[])}function l(){return!!(p.item.title&&p.item.item_type_id&&p.item.title.length>=3)}function u(){return"undefined"!=typeof p.item.categories&&!(!l()||!p.item.categories.length)}function d(){p.item.id?p.item.save().then(function(t){t&&(a.success("Data successfully updated!","Successfully saved"),p.item.isDirty=!1,p.original=angular.copy(p.item),i.updateItem(t),e.go("app.index.editor.indizes.data",{id:p.item.id,name:t.name}))}):o.post("index",p.item).then(function(t){t&&(a.success("Data successfully saved!","Successfully saved"),p.item.isDirty=!1,p.original=angular.copy(p.item),i.addItem(t),e.go("app.index.editor.indizes.data",{id:t.id,name:t.name}))})}var p=this;p.original=angular.copy(p.item),p.checkBase=l,p.checkFull=u,p.save=d,p.baseOptions={drag:!0,allowDrop:!0,allowDrag:!0,allowMove:!0,allowSave:!0,allowDelete:!0,allowAddContainer:!0,allowAdd:!0,editable:!0,assigments:!0,saveClick:d,addClick:p.options.indizes.addClick,addContainerClick:p.options.indizes.addContainerClick,deleteDrop:p.options.indizes.deleteDrop,deleteClick:p.options.indizes.deleteClick},c(),t.$watch("vm.item",function(t,e){t!=e&&(p.item.isDirty=!angular.equals(p.item,p.original))},!0)}])}(),function(){"use strict";angular.module("app.directives").directive("killContextMenu",function(){return function(t,e){return e.bind("contextmenu",function(t){t.preventDefault()})}})}(),function(){"use strict";angular.module("app.controllers").controller("KillContextMenuCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("median",["$timeout","$window",function(t,e){var n=function(){return{id:"gradient",width:340,height:40,info:!0,field:"score",handling:!0,showValue:!0,min:0,max:100,margin:{left:0,right:0,top:10,bottom:10},colors:[{position:0,color:"rgba(102,102,102,1)",opacity:1},{position:53,color:"rgba(128, 243, 198,1)",opacity:1},{position:100,color:"rgba(255,255,255,1)",opacity:0}]}};return{restrict:"E",scope:{data:"=",options:"="},require:"ngModel",link:function(r,a,o,i){function c(){S.range([u.margin.left,u.width-u.margin.right]).clamp(!0),d.attr("width",u.width).attr("height",u.height).style("margin-left",u.margin.left),x.attr("d",s(0,0,u.width,u.height/2,u.height/4,!0,!0,!0,!0)).attr("y",u.height/2).attr("width",u.width).attr("height",u.height/2).style("fill","url(#"+(u.field+u.unique)+")"),C.attr("transform","translate("+u.height/2+", "+u.height/2+")").attr("class","startLabel"),u.info===!0&&(C.attr("r",u.height/2),_.text(u.min).style("font-size",u.height/2.5).attr("text-anchor","middle").attr("y",".35em").attr("id","lowerValue"),b.attr("transform","translate("+(u.width-u.height/2)+", "+u.height/2+")").attr("class","endLabel"),b.append("circle").attr("r",u.height/2),I.text(function(){if(u.max>1e3){var t=(parseInt(u.max)/1e3).toString();return t.substr(0,t.indexOf("."))+"k"}return u.max}).style("font-size",u.height/2.5).attr("text-anchor","middle").attr("y",".35em").attr("id","upperValue"),$.attr("x1",u.width/2).attr("y1",0).attr("x2",u.width/2).attr("y2",u.height).attr("stroke-dasharray","3,3").attr("stroke-width",1).attr("stroke","rgba(0,0,0,87)")),E.on("mouseover",function(){h.transition().duration(200).attr("stdDeviation",2)}).on("mouseout",function(){h.transition().duration(200).attr("stdDeviation",1)}),D.attr("r",function(){return u.showValue?u.height/2+u.height/10:u.height/4}),u.color&&D.style("fill","#fff"),u.showValue&&k.style("font-size",u.height/2.5).attr("text-anchor","middle").attr("y","0.35em"),i.$modelValue?(u.showValue&&k.text(l(i.$modelValue[u.field])),E.transition().duration(500).ease("quad").attr("transform","translate("+S(i.$modelValue[u.field])+","+u.height/2+")")):u.showValue&&k.text(0)}function s(t,e,n,r,a,o,i,c,s){var l;return l="M"+(t+a)+","+e,l+="h"+(n-2*a),i?l+="a"+a+","+a+" 0 0 1 "+a+","+a:(l+="h"+a,l+="v"+a),l+="v"+(r-2*a),s?l+="a"+a+","+a+" 0 0 1 "+-a+","+a:(l+="v"+a,l+="h"+-a),l+="h"+(2*a-n),c?l+="a"+a+","+a+" 0 0 1 "+-a+","+-a:(l+="h"+-a,l+="v"+-a),l+="v"+(2*a-r),o?l+="a"+a+","+a+" 0 0 1 "+a+","+-a:(l+="v"+-a,l+="h"+a),l+="z"}function l(t){if(parseInt(t)>1e3){var e=(parseInt(t)/1e3).toString();return e.substr(0,e.indexOf("."))+"k"}return parseInt(t)}var u=angular.extend(n(),o);u=angular.extend(u,r.options),u.width=a.parent()[0].clientWidth-u.margin.left-u.margin.right,u.unique=(new Date).getTime(),a.css("height",u.height+"px").css("border-radius",u.height/2+"px"),u.color&&(u.colors[1].color=u.color),r.options.max||angular.forEach(r.data,function(t,e){u.max=d3.max([u.max,parseInt(t[u.field])]),u.min=d3.min([u.min,parseInt(t[u.field])])});var d=d3.select(a[0]).append("svg"),p=d.append("g"),f=p.append("svg:defs"),m=f.append("svg:linearGradient").attr("id",u.field+u.unique).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad"),g=f.append("filter").attr("id","drop-shadow").attr("height","150%"),h=g.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",1).attr("result","blur"),v=(g.append("feOffset").attr("in","blur").attr("dx",0).attr("dy",0).attr("result","offsetBlur"),g.append("feMerge"));v.append("feMergeNode").attr("in","offsetBlur"),v.append("feMergeNode").attr("in","SourceGraphic");var y=p.append("g").attr("transform","translate(0, "+u.height/4+")"),x=y.append("path"),C=p.append("g"),b=p.append("g"),w=p.append("g").attr("class","slider");w.select(".background").attr("height",u.height);var S=d3.scale.linear();if(S.domain([u.min,u.max]).range([u.margin.left,u.width-u.margin.left]).clamp(!0),angular.forEach(u.colors,function(t){m.append("svg:stop").attr("offset",t.position+"%").attr("stop-color",t.color).attr("stop-opacity",t.opacity)}),u.info===!0){C.append("circle").attr("r",u.height/2);var _=C.append("text").text(u.min).style("font-size",u.height/2.5).attr("text-anchor","middle").attr("y",".35em").attr("id","lowerValue");b.attr("transform","translate("+(u.width-u.height/2)+", "+u.height/2+")").attr("class","endLabel"),b.append("circle").attr("r",u.height/2);var I=b.append("text").text(function(){if(u.max>1e3){var t=(parseInt(u.max)/1e3).toString();return t.substr(0,t.indexOf("."))+"k"}return u.max}).style("font-size",u.height/2.5).attr("text-anchor","middle").attr("y",".35em").attr("id","upperValue")}if(u.info===!0)var $=w.append("line").attr("x1",u.width/2).attr("y1",0).attr("x2",u.width/2).attr("y2",u.height).attr("stroke-dasharray","3,3").attr("stroke-width",1).attr("stroke","rgba(0,0,0,87)");var E=w.append("g"),D=E.append("circle").attr("class","handle").style("filter","url(#drop-shadow)");if(u.showValue)var k=E.append("text").text(0);r.$watch("options",function(t,e){t!==e&&(u.colors[1].color=t.color,m=p.append("svg:defs").append("svg:linearGradient").attr("id",u.field+"_"+t.color).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad"),angular.forEach(u.colors,function(t){m.append("svg:stop").attr("offset",t.position+"%").attr("stop-color",t.color).attr("stop-opacity",t.opacity)}),x.style("fill","url(#"+u.field+"_"+t.color+")"),D.style("fill",t.color),i.$modelValue?(u.showValue&&k.text(l(i.$modelValue[0][t.field])),E.transition().duration(500).ease("quad").attr("transform","translate("+S(i.$modelValue.data[0][t.field])+","+u.height/2+")")):u.showValue&&k.text(0))},!0),r.$watch(function(){return i.$modelValue},function(t,e){return t?(u.showValue&&k.text(l(t[u.field])),void(t==e?E.attr("transform","translate("+S(t[u.field])+","+u.height/2+")"):E.transition().duration(500).ease("quad").attr("transform","translate("+S(t[u.field])+","+u.height/2+")"))):(u.showValue&&k.text(parseInt(0)),void E.attr("transform","translate("+S(0)+","+u.height/2+")"))}),r.$watch("data",function(t,e){return t!==e&&(u.min=0,u.max=0,angular.forEach(r.data,function(t,e){r.options.max||(u.max=d3.max([u.max,parseInt(t[u.field])]),u.min=d3.min([u.min,parseInt(t[u.field])])),t.iso==i.$modelValue.iso&&(u.showValue&&k.text(l(t.data[0][u.field])),E.transition().duration(500).ease("quad").attr("transform","translate("+S(t.data[0][u.field])+","+u.height/2+")"))}),S=d3.scale.linear().domain([u.min,u.max]).range([u.margin.left,u.width-u.margin.left]).clamp(!0),C.select("#lowerValue").text(min),b.select("#upperValue").text(function(){if(u.max>1e3){var t=(parseInt(u.max)/1e3).toString();return t.substr(0,t.indexOf("."))+"k"}return u.max}),void angular.forEach(r.data,function(t,e){t.iso==i.$modelValue.iso&&(u.showValue&&k.text(l(t.data[0][u.field])),E.transition().duration(500).ease("quad").attr("transform","translate("+S(t.data[0][u.field])+","+u.height/2+")"))}))}),e.onresize=function(){u.width=a.parent()[0].clientWidth-u.margin.left-u.margin.right,c()},r.$watch(o.ngIf,function(){t(function(){u.width=a.parent()[0].clientWidth-u.margin.left-u.margin.right,c()})}),c()}}}])}(),function(){"use strict";angular.module("app.controllers").controller("MedianCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("panels",["$window",function(t){return{restrict:"EA",templateUrl:"views/directives/panels/panels.html",controller:"PanelsCtrl",link:function(t,e,n){function r(t){var e=t.index();u.children("li").eq(e).add(t).addClass("selected"),transitionsNotSupported?(l.addClass("slide-out").removeClass("selected"),u.children("li").eq(e).addClass("content-visible"),f=!1):a(l,e,0,!0)}function a(t,e,n,r){0==n&&i(),e!=-1&&0==n&&(n=1);var c=o();c==e&&(c=o()),n<m-1?(t.eq(c).toggleClass("slide-out",r),setTimeout(function(){a(t,e,n+1,r)},150)):n==m-1&&t.eq(c).toggleClass("slide-out",r).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){e!=-1?(u.children("li.selected").addClass("content-visible"),t.eq(e).addClass("slide-out").removeClass("selected")):p.hasClass("nav-visible")&&r&&p.addClass("nav-clickable"),t.eq(c).off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"),f=!1})}function o(){var t=Math.floor(Math.random()*g.length),e=g[t];return g.splice(t,1),e}function i(){g.length=0;for(var t=0;t<m;t++)g.push(t)}var c=e.next(),s=e.find("ul"),l=s.children("li"),u=document.querySelector(".cd-projects"),d=angular.element(document.querySelector(".cd-nav-trigger")),p=e.find("nav"),f=!1,m=u.querySelector("li").length,g=[];s.on("click",function(t){t.preventDefault(),0==f&&(f=!0,d.add(c).addClass("project-open"),r($(this).parent("li")))})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("PanelsCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("parseConflictCsv",["$state","$timeout","toastr",function(t,e,n){return{restrict:"EA",templateUrl:"views/directives/parseConflictCsv/parseConflictCsv.html",controller:"ParseConflictCsvCtrl",scope:{nations:"=",sum:"="},link:function(t,n,r){var a,o=0,i=0,c=0,s=0,l=!0,u=n.find("button"),d=n.find("input"),p=!1,f=[],m={};d.css({display:"none"}),u.bind("click",function(){d[0].click()}),d.bind("change",function(n){p=!1,f=[],m={},o=[],i=0,c=0,s=0,a,l=!0,t.nations=[],e(function(){d[0].files[0].size,Papa.parse(d[0].files[0],{skipEmptyLines:!0,header:!0,dynamicTyping:!0,fastMode:!0,step:function(e){var n=e.data[0].conflicts.match(/[0-9]+/g).map(function(t){return+t});e.data[0].events=n,t.sum+=n.length,t.nations.push(e.data[0])},complete:function(){t.$apply()}})})})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("ParseConflictCsvCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("parseConflictEventsCsv",["$state","$timeout","toastr",function(t,e,n){return{restrict:"EA",templateUrl:"views/directives/parseConflictEventsCsv/parseConflictEventsCsv.html",controller:"ParseConflictEventsCsvCtrl",scope:{events:"="},link:function(t,n,r){var a,o=0,i=0,c=0,s=0,l=!0,u=n.find("button"),d=n.find("input"),p=!1,f=[],m={};d.css({display:"none"}),u.bind("click",function(){d[0].click()}),d.bind("change",function(n){p=!1,f=[],m={},t.events=[],o=[],i=0,c=0,s=0,a,l=!0,e(function(){d[0].files[0].size,Papa.parse(d[0].files[0],{skipEmptyLines:!0,header:!0,dynamicTyping:!0,fastMode:!0,step:function(e){switch(e.data[0].type){case"interstate":e.data[0].type_id=1;break;case"intrastate":e.data[0].type_id=2;break;case"substate":e.data[0].type_id=3}0==e.errors.length?t.events.push(e.data[0]):console.log(e)},complete:function(){t.$apply()}})})})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("ParseConflictEventsCsvCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("parsecsv",["$state","$timeout","toastr","IndexService",function(t,e,n,r){return{restrict:"EA",templateUrl:"views/directives/parsecsv/parsecsv.html",controller:"ParsecsvCtrl",replace:!0,link:function(a,o,i){var c,s=0,l=0,u=0,d=0,p=!0,f=o.find("button"),m=o.find("input"),g=!1,h=[],v={};m.css({display:"none"}),f.bind("click",function(){m[0].click()}),m.bind("change",function(a){g=!1,h=[],v={},s=[],l=0,u=0,d=0,c,p=!0,e(function(){r.clear();m[0].files[0].size,Papa.parse(m[0].files[0],{skipEmptyLines:!0,header:!0,dynamicTyping:!0,fastMode:!0,worker:!1,chunk:function(t){angular.forEach(t.data,function(t,e){var n={data:{},errors:[]};angular.forEach(t,function(t,e){if((isNaN(t)||t<0)&&("#NA"==t.toString().toUpperCase()||t.toString().toUpperCase().indexOf("N/A")>-1)){var r={type:"1",message:"Field in row is not valid for database use!",column:e,value:t};n.errors.push(r),s.push(r)}}),g?angular.forEach(t,function(t,e){3==e.length&&("undefined"==typeof v[e].data&&(v[e].data=[]),v[e].data.push(t))}):(n.data=t,r.addData(n))})},beforeFirstChunk:function(t){var e=t.match(/\r\n|\r|\n/).index,n=",",r=t.substr(0,e).split(",");r.length<2&&(r=t.substr(0,e).split("\t"),n="\t");for(var a=[],o=0;o<=r.length;o++)if(r[o]){r[o]=r[o].replace(/[^a-z0-9]/gi,"_").toLowerCase(),r[o].indexOf(".")>-1&&(r[o]=r[o].substr(0,r[o].indexOf(".")));var i=r[o].split("_");if(i.length>1){r[o]="";for(var c=0;c<i.length;c++)isNaN(i[c])&&(c>0&&(r[o]+="_"),r[o]+=i[c])}3==r[o].length&&a.push(!0)}if(r.length==a.length){g=!0;for(var o=0;o<=r.length;o++)"undefined"==typeof v[r[o]]&&(v[r[o]]={}),v[r[o]].data=[]}return r.join(n)+t.substr(e)},error:function(t,e){ToastService.error(t)},complete:function(a){r.setErrors(s),g?(angular.forEach(v,function(t,e){if(t.errors=[],"undefined"!=t.toLowerCase()&&"undefined"!=typeof e){var n={iso:e.toUpperCase()};angular.forEach(t.data,function(e,r){n["column_"+r]=e,(isNaN(e)||e<0)&&("NA"==e.toString().toUpperCase()||e<0||e.toString().toUpperCase().indexOf("N/A")>-1)&&(t.errors.push({type:"1",message:"Field in row is not valid for database use!",column:t}),s++)}),r.addData({data:[n],errors:t.errors})}}),r.setIsoField("iso")):angular.forEach(r.getFirstEntry().data,function(t,e){e.toLowerCase().indexOf("iso")==-1&&e.toLowerCase().indexOf("code")==-1||r.setIsoField(e),e.toLowerCase().indexOf("country")!=-1&&r.setCountryField(e),e.toLowerCase().indexOf("year")!=-1&&4==t.toString().length&&r.setYearField(e),e.toLowerCase().indexOf("gender")==-1&&e.toLowerCase().indexOf("sex")==-1||r.setGenderField(e)}),r.setToLocalStorage(),e(function(){n.info(r.getDataSize()+" lines importet!","Information"),t.go("app.index.check")})}})})})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("ParsecsvCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("piechart",function(){return{restrict:"EA",templateUrl:"views/directives/piechart/piechart.html",controller:"PiechartCtrl",scope:{data:"=chartData",activeType:"=",activeConflict:"=",clickIt:"&"},link:function(t,e,n){function r(e){t.clickIt({type_id:e.data.type_id})}function a(e){g=angular.copy(t.activeType),t.activeType=[e.data.type_id],t.$apply()}function o(e){t.activeType=g,t.$apply()}function i(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return p(e(t))}}function c(t){var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return f(e(t))}}var s={},l={w:150,h:150};l.r=Math.min(l.w,l.h)/2;var u=d3.select(e[0]).append("svg").attr("width",l.w).attr("height",l.h).attr("class","outer-pie").append("g").attr("transform","translate("+l.w/2+","+l.h/2+")"),d=d3.select(e[0]).append("svg").attr("width",l.w).attr("height",l.h).attr("class","inner-pie").append("g").attr("transform","translate("+l.w/2+","+l.h/2+")"),p=d3.svg.arc().outerRadius(l.r-10).innerRadius(l.r-23),f=d3.svg.arc().outerRadius(l.r-23).innerRadius(0),m=d3.layout.pie().sort(null).value(function(t){
return t.count});u.datum(t.data).selectAll("path").data(m).enter().append("path").attr("d",p).each(function(t){this._current=t}).style("fill",function(t){return t.data.color}).on("mouseover",a).on("mouseout",o),d.datum(t.data).selectAll("path").data(m).enter().append("path").attr("d",f).each(function(t){this._current=t}).style("fill",function(t){return t.data.color}).style("cursor","pointer").on("click",r);s.update=function(t){u.selectAll("path").data(m(t)).transition().duration(500).attrTween("d",i)};var g=angular.copy(t.activeType);t.$watch("data",function(t,e){return t!==e&&(u.selectAll("path").data(m(t)).transition().duration(500).attrTween("d",i),void d.selectAll("path").data(m(t)).transition().duration(500).attrTween("d",c))})}}})}(),function(){"use strict";angular.module("app.controllers").controller("PiechartCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("roundbar",function(){return{restrict:"EA",controller:"RoundbarCtrl",scope:{data:"=chartData",activeType:"=",activeConflict:"="},link:function(t,e,n){function r(t,e,n,r,a,o,i,c,s){var l;return l="M"+(t+a)+","+e,l+="h"+(n-2*a),i?l+="a"+a+","+a+" 0 0 1 "+a+","+a:(l+="h"+a,l+="v"+a),l+="v"+(r-2*a),s?l+="a"+a+","+a+" 0 0 1 "+-a+","+a:(l+="v"+a,l+="h"+-a),l+="h"+(2*a-n),c?l+="a"+a+","+a+" 0 0 1 "+-a+","+-a:(l+="h"+-a,l+="v"+-a),l+="v"+(2*a-r),o?l+="a"+a+","+a+" 0 0 1 "+a+","+-a:(l+="v"+-a,l+="h"+a),l+="z"}var a={top:40,right:20,bottom:30,left:40},o=300-a.left-a.right,i=200-a.top-a.bottom,c=20,s=25,l={y:d3.scale.linear()};l.y.domain([0,220]),l.y.range([i,0]);var u=d3.select(e[0]).append("svg").attr("width",o+a.left+a.right).attr("height",i+a.top+a.bottom).append("g").attr("transform","translate(0,"+a.top+")"),d=u.selectAll(".bars").data(t.data).enter().append("g").attr("class","bars"),p=(d.append("path").attr("d",function(t,e){return r(e*(c+s),0,c,i,c/2,!0,!0,!1,!1)}).attr("class","bg"),d.append("path").attr("d",function(t,e){return r(e*(c+s),l.y(t.value),c,i-l.y(t.value),c/2,!0,!0,!1,!1)}).style("fill",function(t){return t.color})),f=d.append("text");f.text(function(t){return t.value}).attr("x",function(t,e){return e*(c+s)}).attr("y",-8).attr("width",function(t){return c}).style("fill","#4fb0e5");var m=d.append("text");m.text(function(t){return t.label}).attr("x",function(t,e){return e*(c+s)}).attr("y",i+20).attr("width",function(t){return c}).style("fill",function(t){return t.color}),t.$watch("data",function(e,n){return e!==n&&(p.transition().duration(500).attr("d",function(e,n){var a=c/2;return t.data[n].value<=10&&(a=0),r(n*(c+s),l.y(t.data[n].value),c,i-l.y(t.data[n].value),a,!0,!0,!1,!1)}),void f.transition().duration(500).tween("text",function(e,n){var n=d3.interpolate(parseInt(e.value),parseInt(t.data[n].value));return function(t){this.textContent=Math.round(1*n(t))/1}}).each("end",function(e,n){e.value=t.data[n].value}))})}}})}(),function(){"use strict";angular.module("app.controllers").controller("RoundbarCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("simplelinechart",function(){return{restrict:"E",templateUrl:"views/directives/simplelinechart/simplelinechart.html",controller:"SimplelinechartCtrl",controllerAs:"vm",scope:{},bindToController:{data:"=",selection:"=",options:"="},link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("SimplelinechartCtrl",["$scope",function(t){function e(){a(),r()}function n(){o.chart.options.chart.forceY=[o.range.max,o.range.min]}function r(){return o.chart.options.chart={type:"lineChart",legendPosition:"left",duration:0,margin:{top:20,right:20,bottom:20,left:20},x:function(t){return t.x},y:function(t){return t.y},showLegend:!1,showValues:!1,transitionDuration:500,forceY:[o.range.max,o.range.min],xAxis:{axisLabel:"Year",axisLabelDistance:30},yAxis:{axisLabel:"",axisLabelDistance:30},legend:{rightAlign:!1},lines:{interpolate:"cardinal"}},1==o.options.invert&&(o.chart.options.chart.forceY=[parseInt(o.range.max),o.range.min]),o.chart}function a(){var t=[];return o.range={max:0,min:1e3},angular.forEach(o.selection,function(e,n){var r={id:n,key:e.title,color:e.color,values:[]};angular.forEach(o.data,function(t,n){r.values.push({id:n,x:t[e.fields.x],y:t[e.fields.y]}),o.range.max=Math.max(o.range.max,t[e.fields.y]),o.range.min=Math.min(o.range.min,t[e.fields.y])}),t.push(r)}),o.range.max++,o.range.min--,o.chart.data=t,"true"==o.options.invert&&(o.chart.options.chart.yDomain=[parseInt(o.range.max),o.range.min]),t}var o=this,i=function(){return{invert:!1}};o.options=angular.extend(i(),o.options),o.config={visible:!0,extended:!1,disabled:!1,autorefresh:!0,refreshDataOnly:!1,deepWatchOptions:!0,deepWatchData:!0,deepWatchConfig:!0,debounce:10},o.chart={options:{chart:{}},data:[]},e(),t.$watch("vm.data",function(t,e){t&&(a(),n())}),t.$watch("vm.selection",function(t,e){})}])}(),function(){"use strict";angular.module("app.directives").animation(".slide-toggles",["$animateCss",function(t){function e(t){var e=t[0].getAttribute("data-slide-toggle");return e||(e=++a,t[0].setAttribute("data-slide-toggle",e)),e}function n(t){var e=o[t];return e||(e={},o[t]=e),e}function r(t,e,n,r,a){return function(){e.animating=!0,e.animator=n,e.doneFn=a,n.start()["finally"](function(){t&&e.doneFn===a&&(r[0].style.height=""),e.animating=!1,e.animator=void 0,e.doneFn()})}}var a=0,o={};return{leave:function(a,o){var i=n(e(a)),c=i.animating&&i.height?i.height:a[0].offsetHeight,s=t(a,{from:{height:c+"px",opacity:1},to:{height:"0px",opacity:0}});return s?i.animating?(i.doneFn=r(!0,i,s,a,o),i.animator.end()):(i.height=c,r(!0,i,s,a,o)()):void o()},enter:function(a,o){var i=n(e(a)),c=i.animating&&i.height?i.height:a[0].offsetHeight,s=t(a,{from:{height:"0px",opacity:0},to:{height:c+"px",opacity:1}});return s?i.animating?(i.doneFn=r(!1,i,s,a,o),i.animator.end()):(i.height=c,r(!1,i,s,a,o)()):void o()}}}])}(),function(){"use strict";angular.module("app.controllers").controller("SlideToggleCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("styles",function(){return{restrict:"E",templateUrl:"views/directives/styles/styles.html",controller:"StylesCtrl",controllerAs:"vm",scope:{},bindToController:{item:"=",styles:"=",options:"=",save:"&"},replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("StylesCtrl",["toastr","DataService",function(t,e){function n(t){o.item.style_id==t.id?o.item.style_id=0:(o.item.style_id=t.id,o.item.style=t)}function r(t,e){return o.item.style_id==e.id}function a(){e.post("styles",o.style).then(function(e){o.styles.push(e),o.createStyle=!1,o.style=[],o.item.style=e,t.success("New Style has been saved","Success")})}var o=this;o.toggleStyle=n,o.selectedStyle=r,o.saveStyle=a,o.style=[]}])}(),function(){"use strict";function t(t,e){function n(t,e,n){}return{restrict:"E",replace:!0,controller:"SubindexCtrl",templateUrl:"views/directives/subindex/subindex.html",link:n}}angular.module("app.directives").directive("subindex",t),t.$inject=["$timeout","smoothScroll"]}(),function(){"use strict";angular.module("app.controllers").controller("SubindexCtrl",["$scope","$filter","$timeout",function(t,e,n){function r(){t.calcSubRank(),t.setChart(),t.calculateGraph(),t.createIndexer(),t.createOptions(),t.$watch("display.selectedCat",function(e,n){return e!==n&&(t.createIndexer(),t.calculateGraph(),t.createOptions(),void t.calcSubRank())}),t.$watch("current",function(e,n){e!==n&&t.calcSubRank()})}function a(){t.info=!t.info}function o(){var n=0;angular.forEach(t.data,function(e){e[t.display.selectedCat.type]=parseFloat(e[t.display.selectedCat.type]),e.score=parseInt(e.score)});for(var r=e("orderBy")(t.epi,[t.display.selectedCat.type,"score"],!0),a=0;a<r.length;a++)r[a].iso==t.current.iso&&(n=a+1);t.current[t.display.selectedCat.type+"_rank"]=n}function i(n){var r=e("orderBy")(t.epi,[t.display.selectedCat.type,"score"],!0),a=0;return angular.forEach(r,function(t,e){t.country==n.country&&(a=e)}),a+1}function c(){t.indexer=[t.$parent.display.selectedCat.data]}function s(){t.medianOptions={color:t.$parent.display.selectedCat.color,field:t.$parent.display.selectedCat.type,handling:!1,margin:{left:10}},t.medianOptionsBig={color:t.$parent.display.selectedCat.color,field:t.$parent.display.selectedCat.type,handling:!1,margin:{left:20}}}function l(){return t.chart={options:{chart:{type:"lineChart",legendPosition:"left",margin:{top:20,right:20,bottom:20,left:20},x:function(t){return t.x},y:function(t){return t.y},showValues:!1,showYAxis:!1,transitionDuration:500,useInteractiveGuideline:!0,forceY:[100,0],xAxis:{axisLabel:""},yAxis:{axisLabel:"",axisLabelDistance:30},legend:{rightAlign:!1,margin:{bottom:30}},lines:{interpolate:"cardinal"}}},data:[]},t.chart}function u(){var e=[];angular.forEach(t.display.selectedCat.children,function(n,r){var a={key:n.title,color:n.color,values:[]};angular.forEach(t.country.epi,function(t){a.values.push({x:t.year,y:t[n.column_name]})}),e.push(a)}),t.chart.data=e}t.info=!1,t.setChart=l,t.calculateGraph=u,t.createIndexer=c,t.calcSubRank=o,t.toggleInfo=a,t.createOptions=s,t.getSubRank=i,r()}])}(),function(){"use strict";angular.module("app.directives").directive("sunburst",function(){var t=function(){return{mode:"size"}};return{restrict:"E",controller:"SunburstCtrl",scope:{data:"="},link:function(e,n,r){function a(t){$.transition().duration(g).attrTween("d",c(t)),E.style("visibility",function(e){return o(t,e)?null:d3.select(this).style("visibility")}).transition().duration(g).attrTween("text-anchor",function(t){return function(){return t.depth,"middle"}}).attrTween("transform",function(t){(t.name||"").split(" ").length>2;return function(){var e=(t.name||"").split(" ").length>2,n=t.x>.5?2:-2,r=180*p(t.x+t.dx/2)/Math.PI-90+(e?n:0),a=r+(e?-.5:0),o=f(t.y)+h+35,i=r>90?-180:0;return t.name!=S&&t.name!=_||(a+=1),0==t.depth?(o=-2.5,a=0,i=0):1==t.depth?o+=-9:2==t.depth?o+=-5:3==t.depth&&(o+=4),"rotate("+a+")translate("+o+")rotate("+i+")"}}).style("fill-opacity",function(e){return o(t,e)?1:1e-6}).each("end",function(e){d3.select(this).style("visibility",o(t,e)?null:"hidden")})}function o(t,e){return t===e||!!t.children&&t.children.some(function(t){return o(t,e)})}function i(t){return t.color?t.color:"#ccc"}function c(t){var e=s(t),n=d3.interpolate(p.domain(),[t.x,t.x+t.dx-9e-4]),r=d3.interpolate(f.domain(),[t.y,e]),a=d3.interpolate(f.range(),[t.y?20:0,d]);return function(t){return function(e){return p.domain(n(e)),f.domain(r(e)).range(a(e)),C(t)}}}function s(t){return t.children?Math.max.apply(Math,t.children.map(s)):t.y+t.dy}angular.extend(t(),r);e.setChart(),e.calculateGraph();var l=610,u=l,d=l/2,p=d3.scale.linear().range([0,2*Math.PI]),f=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,d]),m=0,g=1e3,h=10,v=d3.select(n[0]),y=v.append("svg").attr("width",l+2*m).attr("height",u+2*m).append("g").attr("transform","translate("+[d+m,d+m]+")"),x=d3.layout.partition().sort(null).value(function(t){return 1}),C=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,p(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,p(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,t.y?f(t.y):t.y)}).outerRadius(function(t){return Math.max(0,f(t.y+t.dy))}),b="Wastewater Treatment",w="Air Pollution PM2.5 Exceedance",S="Agricultural Subsidies",_="Pesticide Regulation",I=x.nodes(e.calculateGraph()),$=y.selectAll("path").data(I);$.enter().append("path").attr("id",function(t,e){return"path-"+e}).attr("d",C).attr("fill-rule","evenodd").attr("class",function(t){return t.depth?"branch":"root"}).style("fill",i).on("click",a);var E=y.selectAll("text").data(I),D=E.enter().append("text").style("fill-opacity",1).attr("text-anchor",function(t){return t.depth,"middle"}).attr("id",function(t){return"depth"+t.depth}).attr("class",function(t){return"sector"}).attr("dy",function(t){return t.depth?".2em":"0.35em"}).attr("transform",function(t){var e=(t.name||"").split(" ").length>2,n=t.x>.5?2:-2,r=180*p(t.x+t.dx/2)/Math.PI-90+(e?n:0),a=r+(e?-.5:0),o=f(t.y)+h+35,i=r>90?-180:0;return t.name!=S&&t.name!=_||(a+=1),0==t.depth?(o=-2.5,a=0,i=0):1==t.depth?o+=-9:2==t.depth?o+=-5:3==t.depth&&(o+=4),"rotate("+a+")translate("+o+")rotate("+i+")"}).on("click",a);D.append("tspan").attr("x",0).text(function(t){return 3==t.depth&&t.name!=b&&t.name!=w&&t.name!=S&&t.name!=_?t.name.split(" ")[0]+" "+(t.name.split(" ")[1]||""):t.name.split(" ")[0]}),D.append("tspan").attr("x",0).attr("dy","1em").text(function(t){return 3==t.depth&&t.name!=b&&t.name!=w&&t.name!=S&&t.name!=_?(t.name.split(" ")[2]||"")+" "+(t.name.split(" ")[3]||""):(t.name.split(" ")[1]||"")+" "+(t.name.split(" ")[2]||"")}),D.append("tspan").attr("x",0).attr("dy","1em").text(function(t){return 3==t.depth&&t.name!=b&&t.name!=w&&t.name!=S&&t.name!=_?(t.name.split(" ")[4]||"")+" "+(t.name.split(" ")[5]||""):(t.name.split(" ")[3]||"")+" "+(t.name.split(" ")[4]||"")})}}})}(),function(){"use strict";angular.module("app.controllers").controller("SunburstCtrl",["$scope",function(t){t.setChart=function(){return t.chart={options:{chart:{type:"sunburst",height:700,sunburst:{dispatch:{},width:null,height:null,mode:"size",id:2088,duration:500,margin:{top:0,right:0,bottom:0,left:0}},tooltip:{duration:0,gravity:"w",distance:25,snapDistance:0,classes:null,chartContainer:null,fixedTop:null,enabled:!0,hideDelay:400,headerEnabled:!1,offset:{left:0,top:0},hidden:!0,data:null,tooltipElem:null,id:"nvtooltip-99347"}}},data:[]},t.chart};var e=function(t){var n=[];return angular.forEach(t,function(t){var r={name:t.title,size:t.size,color:t.color,children:e(t.children)};t.color&&(r.color=t.color),t.size&&(r.size=t.size),n.push(r)}),n};t.calculateGraph=function(){var n={name:t.data.title,color:t.data.style.base_color||"#000",children:e(t.data.children),size:1};return t.chart.data=n,n},t.$watch("data",function(e,n){e&&t.calculateGraph()})}])}(),function(){"use strict";angular.module("app.directives").directive("treemenu",function(){return{restrict:"EA",templateUrl:"views/directives/treemenu/treemenu.html",controller:"TreemenuCtrl",controllerAs:"vm",scope:{},bindToController:{options:"=",item:"=?",selection:"=?"},replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("TreemenuCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("treeview",["RecursionHelper",function(t){var e={editWeight:!1,drag:!1,edit:!1,children:"children"};return{restrict:"E",templateUrl:"views/directives/treeview/treeview.html",controller:"TreeviewCtrl",controllerAs:"vm",scope:{},bindToController:{items:"=",item:"=?",selection:"=?",options:"=?",active:"=?",click:"&"},replace:!0,compile:function(n){return t.compile(n,function(t,n,r,a,o){angular.extend(e,t.vm.options)})}}}])}(),function(){"use strict";angular.module("app.controllers").controller("TreeviewCtrl",["$filter",function(t){function e(){"undefined"==typeof l.options&&(l.options={editWeight:!1,drag:!1,edit:!1,children:"children"}),"undefined"==typeof l.options.children&&(l.options.children="children"),"undefined"==typeof l.selection&&(l.selection=[])}function n(t,e,n,r){return!0}function r(t,e,n,r){return angular.forEach(l.items,function(t,e){0==t.id&&l.items.splice(e,1)}),n}function a(t,e,n){if(l.options.allowMove)return l.items.splice(t,1)}function o(t){var e=-1;angular.forEach(l.selection,function(n,r){n.id==t.id&&(e=r)}),e>-1?l.selection.splice(e,1):l.selection.push(t),"function"==typeof l.options.selectionChanged&&l.options.selectionChanged()}function i(t){t[l.options.children]=[],t.expanded=!0}function c(t){var e=!1;return angular.forEach(l.selection,function(n){n.id==t.id&&(e=!0)}),e}function s(t){var e=!1;return angular.forEach(t.children,function(t){l.selection.indexOf(t)>-1&&(e=!0),e||(e=s(t))}),e}var l=this;l.selectedItem=c,l.childSelected=s,l.toggleSelection=o,l.onDragOver=n,l.onDropComplete=r,l.onMovedComplete=a,l.addChildren=i,e()}])}(),function(){"use strict";angular.module("app.directives").directive("triangleGraph",function(){return{restrict:"EA",templateUrl:"views/directives/triangle-graph/triangle-graph.html",controller:"TriangleGraphCtrl",controllerAs:"vm",scope:{},bindToController:{data:"=",ngModel:"="},link:function(t,e,n){var r=e.parent()[0].clientWidth-48,a=r/3,o=(d3.scale.linear().domain([0,100]).range([0,r]),d3.scale.linear().domain([0,t.vm.data.length]).range([a,0]),d3.select(e[0]).append("svg").attr("width",r).attr("height",a));o.select(".triangle-grid").selectAll("div").data(t.vm.data).enter().append("div").attr("class","triangle-box")}}})}(),function(){"use strict";angular.module("app.controllers").controller("TriangleGraphCtrl",function(){})}(),function(){"use strict";angular.module("app.directives").directive("weight",function(){return{restrict:"EA",templateUrl:"views/directives/weight/weight.html",controller:"WeightCtrl",controllerAs:"vm",scope:{},bindToController:{items:"=",item:"=",options:"="},replace:!0,link:function(t,e,n){}}})}(),function(){"use strict";angular.module("app.controllers").controller("WeightCtrl",["$scope",function(t){function e(){n()}function n(){"undefined"!=typeof i.item.weight&&i.item.weight||angular.forEach(i.items,function(t){t.weight=100/i.items.length})}function r(){var t=i.item.weight,e=(100-t)/(i.items.length-1);return angular.forEach(i.items,function(t){t!==i.item&&(t.weight=e)}),e}function a(){return!(i.item.weight>=95)&&(i.item.weight%5!=0?i.item.weight=5*Math.round(i.item.weight/5):i.item.weight+=5,void r())}function o(){return!(i.item.weight<=5)&&(i.item.weight%5!=0?i.item.weight=5*Math.round(i.item.weight/5)-5:i.item.weight-=5,void r())}var i=this;i.raiseWeight=a,i.lowerWeight=o,e()}])}();